function CheckBoxClickHandler(e,i){let n=e.id,t=n.replace(/ckbx_/g,""),d=$("input[id='"+n+"']").parent().attr("id"),l=d.replace(/li_/g,""),o=$("li[id='"+d+"']").parent().attr("id");if("Decision"==$("input[id='nodetype_"+o.replace(/li_ul_/g,"")+"']").attr("value")&&(e.checked&&$("input[id='Compact']").is(":checked")?$("li[id='"+d+"']").siblings().hide():($("li[id='"+d+"']").siblings().show(),$("li[id='"+d+"']").siblings().each((function(){RefreshFillers(this.id.replace(/li_/g,""),!1)})))),asynchronous=!1,e.checked&&0==$("ul[id='li_ul_"+t+"']").children().length?$.jstree._reference("li[id='li_"+t+"']").open_node("li[id='li_"+t+"']"):(!e.checked&&$("input[id='Compact']").is(":checked")&&$("#container").jstree("close_node",$("li[id='li_"+t+"']")),e.checked&&$("#container").jstree("open_node",$("li[id='li_"+t+"']"))),asynchronous=!0,e.checked){let e=$("li[id='"+d+"']").parent("ul").parent("li");for(;"li_1"!=e.attr("id")&&(!$("input[id='ckbx_"+e.attr("id").replace(/li_/g,"")+"']").length||$("input[id='ckbx_"+e.attr("id").replace(/li_/g,"")+"']").is(":checked"));)e=e.parent("ul").parent("li");"li_1"!=e.attr("id")&&($("input[id='ckbx_"+e.attr("id").replace(/li_/g,"")+"']").attr("checked",!0),CheckBoxClickHandler(document.getElementById("ckbx_"+e.attr("id").replace(/li_/g,"")),!1))}let a=e.checked?"true":"false";if($.ajax({url:"SetCheckboxState?id="+t+"&state="+a,type:"GET",dataType:"json",async:!1,cache:!1,beforeSend:function(){},complete:function(){},success:function(e){$("#price").text("Total: "+e.total);let i=";"+$("input[id='dependents_"+l+"']").attr("value"),n=GetBranch(l).split(";");for(let e=0;e<n.length;e++)-1==i.indexOf(";"+n[e]+";")&&(i=i+";"+n[e]);let t=$("li[id='"+d+"']").find("li");for(let e=0;e<t.length;e++)i+=";"+t[e].id.replace(/li_/g,"");UpdateNodesFromServer(i)}}),e.checked&&"Decision"==$("input[id='nodetype_"+o.replace(/li_ul_/g,"")+"']").attr("value")){let e=$("li[id='"+d+"']").siblings().children("input:checked");if(0!=e.length){let i=";"+e[0].id.replace(/ckbx_/g,""),n=$("li[id='li_"+e[0].id.replace(/ckbx_/g,"")+"']").find("li").filter((function(){return"false"==$("input[id='isoptional_"+$(this).attr("id").replace(/li_/g,"")+"']").attr("value")}));for(let e=0;e<n.length;e++)i+=";"+n[e].id.replace(/li_/g,"");let t=";"+$("input[id='dependents_"+e[0].id.replace(/ckbx_/g,"")+"']").attr("value"),d=t.split(";");for(let e=0;e<d.length;e++)-1==i.indexOf(";"+d[e]+";")&&(i=i+";"+d[e]);i+=t,asynchronous=!0,UpdateNodesFromServer(i)}}e.checked&&!descriptionhidden&&$("li[id='li_"+t+"']").children("a").click(),e.checked||"Decision"!=$("input[id='nodetype_"+o.replace(/li_ul_/g,"")+"']").attr("value")||descriptionhidden||$("li[id='li_"+o.replace(/li_ul_/g,"")+"']").children("a").click(),i&&$("input[id='"+n+"']").is(":checked")&&(asynchronous,ExpandLevels2(t,$("input[id='expandedlevels_"+t+"']").attr("value")))}function UpdateParent(e){$.ajax({url:"NodeInfo?id="+e,type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){let i=$("li[id='li_"+e.id+"']").parent().attr("id");e.complete||e.optional&&!e.selected?$("li[id='li_"+e.id+"']").children("img").first().hide():$("li[id='li_"+e.id+"']").children("img").first().show(),UpdateNode(e),"container"!=$("li[id='li_"+e.id+"']").parent().parent().attr("id")&&UpdateParent(i.replace(/li_ul_/g,""))}})}function UpdateParentSync(e){let i="";!function e(n){i+=n+";";let t="li[id='li_"+n+"']";"container"!=$(t).parent().parent().attr("id")&&(parentULID=$(t).parent().attr("id"),e(parentULID.replace(/li_ul_/g,"")))}(e),UpdateNodesFromServer(i)}function GetBranch(e){let i="";return function e(n){i+=n+";";let t,d="li[id='li_"+n+"']";"container"!=$(d).parent().parent().attr("id")&&(t=$(d).parent().attr("id"),e(t.replace(/li_ul_/g,"")))}(e),i}function BuildDependencies(){overlay=$("<div></div>").prependTo("body").attr("id","overlay"),$("#overlay").show(),$.ajax({url:"BuildDependencies",type:"GET",dataType:"json",async:!0,cache:!1,beforeSend:function(){},complete:function(){$(".loading_dependencies").hide(),$("#overlay").remove()},success:function(e){2==e.length&&alert('Circular reference between nodes: "'+e[0].name+'" and "'+e[1].name+'"'),price=document.getElementById("price"),$(price).text("Total: "+e[0].total),UpdateTreeSync()}})}function getScrollbarWidth(e){return e.offsetWidth-e.clientWidth}function UpdateNode(e){let i="li[id='li_"+e.id+"']";if($(i).length){let n,t;if($(i).css("white-space","normal"),$(i).width($("#container").width()-($(i).offset().left-$("#container").offset().left)),$("input[id='ckbx_"+e.id+"']").remove(),e.optional&&(n=1==e.selected?"checked":"",t="<input type='checkbox' ",e.disabled&&($(i).siblings().show(),t+="disabled='true'"),t+=" id='ckbx_"+e.id+"' style='padding:0px 0px 0px 0px; margin:0px 0px 0px 2px;' onchange='CheckBoxClickHandler(this, true);' "+n+"/>",$(i).children("ins").after(t)),t="<img src='../Images/blinkcircle.gif' class='incomplete' style='display: none;' height='14' width='14'>",$(i).children(".incomplete").remove(),$(i).children("ins").after(t),e.complete||e.optional&&!e.selected?$(i).children(".incomplete").hide():$(i).children(".incomplete").show(),0==$(i).children("a").length){$(i).append("<a></a>");let n="../"+e.url;$(i).children("a").attr("href",n),$(i).children("a").attr("target","details")}else{let n="../"+e.url;$(i).children("a").attr("href",n),$(i).children("a").attr("target","details")}window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&$(i).children("a").attr("style","color:gray;"),window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches&&$(i).children("a").attr("style","color:black;"),e.leaf&&$("li[id='li_"+e.id+"']").children("a").attr("style","color:red;"),e.hidden&&$("li[id='li_"+e.id+"']").children("a").attr("style","color:green"),$("input[id='nodetype_"+e.id+"']")&&$("input[id='nodetype_"+e.id+"']").remove(),$("input[id='ishidden_"+e.id+"']")&&$("input[id='ishidden_"+e.id+"']").remove(),$("input[id='isoptional_"+e.id+"']")&&$("input[id='isoptional_"+e.id+"']").remove(),$("input[id='dependents_"+e.id+"']")&&$("input[id='dependents_"+e.id+"']").remove(),$("input[id='editchildren_"+e.id+"']")&&$("input[id='editchildren_"+e.id+"']").remove(),$("input[id='expandedlevels_"+e.id+"']")&&$("input[id='expandedlevels_"+e.id+"']").remove(),t="<input type='hidden' id='nodetype_"+e.id+"' value='"+e.type+"'/> ",$("li[id='li_"+e.id+"']").append(t),t="<input type='hidden' id='ishidden_"+e.id+"' value='"+e.hidden+"'/> ",$("li[id='li_"+e.id+"']").append(t),t="<input type='hidden' id='isoptional_"+e.id+"' value='"+e.optional+"'/> ",$("li[id='li_"+e.id+"']").append(t),t="<input type='hidden' id='dependents_"+e.id+"' value='"+e.dependents+"'/> ",$("li[id='li_"+e.id+"']").append(t),t="<input type='hidden' id='editchildren_"+e.id+"' value='"+e.editChildren+"'/> ",$("li[id='li_"+e.id+"']").append(t),t="<input type='hidden' id='expandedlevels_"+e.id+"' value='"+e.expandedLevels+"'/> ",$("li[id='li_"+e.id+"']").append(t),$(i).children("a").empty(),$(i).children("a").append("<span class='name' id='name_"+e.id+"'>"+e.name+"</span>"),$(i).children("a").append("<span class='formula' id='formula_"+e.id+"' > "+("Decision"!=e.type&&"SumSet"!=e.type?" &nbsp;[<i>"+e.expression.trim()+"</i>]":" &nbsp;&nbsp;&nbsp;")+"</span>"),$("input[id='Formulas']").is(":checked")||$(i).children("a").children(".formula").hide(),$(i).children(".subtotal")&&$(i).children(".subtotal").remove(),$(i).children(".filler")&&$(i).children(".filler").remove(),$(i).children(".edit")&&$(i).children(".edit").remove(),$(i).children(".add")&&$(i).children(".add").remove(),$(i).children(".remove")&&$(i).children(".remove").remove();let d,l,o,a,r,c,s,p,h,u,f,g,m=$("<div class='filler'>&nbsp;</div>"),v=$("<span class='subtotal' id='subtotal_"+e.id+"'><font size='1'>"+e.type+"</font>  <font>["+e.subtotal+"]</font></span>");$(i).children("a").after(m),$(i).children("a").after(v),$(i).children("a").after("<span title='Remove node' id='remove_"+e.id+"' class='remove' ></span>"),$(i).children("a").after("<span title='Add node' id='add_"+e.id+"' class='add'></span>"),$(i).children("a").after("<span title='Edit: "+e.name+"' id='edit_"+e.id+"' class='edit'></span>"),$(i).children("a").attr("title",e.expression.trim()),$(i).children("a").next().on("click",(function(n){n.preventDefault();let t="li[id='li_"+e.id+"']";descriptionhidden||$(t).children("a").click(),editedNodeId=e.id,$("#inodeOrder").empty();for(let e=0;e<=$(i).siblings().length;e++)$("#inodeOrder").append("<option  value='"+e+"'>"+e+"</option>");FillNodeDialogInfo(editedNodeId),editdialog.dialog("option","title",'Edit: "'+e.name+'"'),editdialog.dialog("open"),$.ajax({url:"getAllNames",type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){allNames.length=0;for(let i of e)allNames.push(i)}})})),$(i).children(".remove").on("click",(function(i){i.preventDefault(),removeNodeIds=e.id,$("#removeNode").children("label").text('Remove "'+e.name+'"?'),removenodedialog.dialog("open")})),$(i).children(".add").on("click",(function(n){n.preventDefault();let t="li[id='li_"+e.id+"']";descriptionhidden||$(t).children("a").click(),addToNodeId=e.id,"Decision"==$("input[id='nodetype_"+e.id+"']").attr("value")?($("#newinodeOptional").prop("checked",!0),$("#newinodeOptional").attr("disabled","disabled")):($("#newinodeOptional").prop("checked",!1),$("#newinodeOptional").attr("disabled",!1)),$("#newinodeOrder").empty();for(let e=0;e<=$(i).children("ul").children("li").length;e++)$("#newinodeOrder").append("<option  value='"+e+"'>"+e+"</option>");newnodedialog.dialog("option","title",'Insert new node into: "'+e.name+'"'),newnodedialog.dialog("open"),$.ajax({url:"getAllNames",type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){allNames.length=0;for(let i of e)allNames.push(i)}})})),p=e.optional?13:0,s=e.complete||e.optional&&!e.selected?0:16,h="Decision"!=e.type?$(i).children(".edit").outerWidth(!0):0,u=$(i).children(".add").outerWidth(!0),f=$(i).children(".remove").outerWidth(!0);let _=$(i).children("a").children(".formula"),w=$(i).children("a").children(".name");if($(i).width($("#container").width()-($(i).offset().left-$("#container").offset().left)),l=$(i).width(),o=$(i).children("a").width(),d=0,marginLeft=0,a=$(i).children(".subtotal").width(),r=$(i).children("ins").width(),"none"==_.css("display")?(_.show(),c=_.width(),_.hide()):c=_.width(),g=w.width(),0==_.children("i").length&&(c=0),o+a+r+p+s+h+u+f+25>l){let e=o+a+r+p+s+h+u+f+25-l;c>=e+25?_.width(c-e-25):(_.width(0),w.width(g-(e-c)))}else _.width(c+5),w.width(g+5);let y=getScrollbarWidth(document.getElementById("container"));if($(i).children(".filler").css("width",l-o-a-r-p-s-h-u-f-30-y),l-o-a-r-d-marginLeft-p-s-h-u-f-30-y>0&&$(i).children(".filler").css("margin-right",a+y),"FONT"!=$("li[id='li_"+e.id+"']").children()[0].tagName){let n=$("li[id='li_1']").position().left;$("<font width='100%' size='1' class='id'>&nbsp"+e.id+"</font>").insertBefore("li[id='li_"+e.id+"']>ins"),$(".id").css({position:"absolute",left:n});let t=$("font[id='id_"+e.Id+"']").width(),d=$(i).children("ins").position().left;t>d?$(i).css("margin-left",t-d+13.5):$(i).css("margin-left",13.5)}$("input[id='Subtotals']").is(":checked")||$(".subtotal, .filler").hide()}}function UpdateNodeFromServer(e){$.ajax({url:"NodeInfo?id="+e,type:"GET",dataType:"json",async:!1,cache:!1,beforeSend:function(){},complete:function(){},success:function(e){e.complete||e.optional&&!e.selected?$("li[id='li_"+e.id+"']").children("img").first().hide():$("li[id='li_"+e.id+"']").children("img").first().show(),UpdateNode(e)}})}function NodeInfo(e){$.ajax({url:"NodeInfo?id="+e,type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){return e.complete||e.optional&&!e.selected?$("li[id='li_"+e.id+"']").children("img").first().hide():$("li[id='li_"+e.id+"']").children("img").first().show(),e}})}function UpdateNodesFromServer(e){let i=[];i=e.split(";"),$.ajax({url:"NodesInfo",type:"POST",dataType:"json",data:{array:i},traditional:!0,async:"true"==asynchronous,cache:!1,beforeSend:function(){},complete:function(){},success:function(e){let i="",n="";for(let t=0;t<e.length;t++)e[t].complete||e[t].optional&&!e[t].selected?n+="li[id='li_"+e[t].id+"'],":i+="li[id='li_"+e[t].id+"'],",UpdateNode(e[t])}})}function UpdateDependents(e){let i="";if("object"==typeof e){let n;i="";for(let n=0;n<e.length;n++)i+=";"+e[n]+";"+$("input[id='dependents_"+e[n]+"']").attr("value");n=i.split(";"),n=n.filter((function(e,i){return n.indexOf(e)===i})),i="";for(let e=0;e<n.length;e++)i+=n[e]+";";UpdateNodesFromServer(i)}else i=$("input[id='dependents_"+e+"']").attr("value"),UpdateNodesFromServer(e+";"+i)}function UpdateTree(e){$.ajax({url:"NodeInfo?id="+e,type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){UpdateNode(e);let i="li[id='li_"+e.id+"']",n=$(i).children("ul").children("li");if(n&&n.length>0)for(let e=0;e<n.length;e++)UpdateTree(n[e].id.replace(/li_/g,""))}})}function UpdateTreeSync(){let e="";!function i(n){e+=n+";";let t=$("li[id='li_"+n+"']").children("ul").children("li");if(t&&t.length>0)for(let e=0;e<t.length;e++)i(t[e].id.replace(/li_/g,""))}(1),UpdateNodesFromServer(e)}function HideNodes(e){"true"==$("input[id='ishidden_"+e+"']").attr("value")&&$("li[id='li_"+e+"']").hide();let i=$("li[id='li_"+e+"']").children("ul").children("li");if(i&&i.length>0)for(let e=0;e<i.length;e++)HideNodes(i[e].id.replace(/li_/g,""))}function ShowNodes(e){"true"==$("input[id='ishidden_"+e+"']").attr("value")&&($("li[id='li_"+e+"']").css("display","block"),RefreshFillers(e,!1));let i=$("li[id='li_"+e+"']").children("ul").children("li");if(i&&i.length>0)for(let e=0;e<i.length;e++)ShowNodes(i[e].id.replace(/li_/g,""))}function UnHideBranch(e){$("li[id='li_"+e+"']").show();let i=$("li[id='li_"+e+"']").parent().attr("id");"container"!=$("li[id='li_"+e+"']").parent().parent().attr("id")&&UnHideBranch(i.replace(/li_ul_/g,""))}function ToggleSubtotals(){$("input[id='Subtotals']").is(":checked")?($(".subtotal").show(),$(".filler").show(),RefreshFillers(1,!0)):($(".subtotal").hide(),$(".filler").hide())}function ToggleFormulas(){expandingLevels=!1,$("input[id='Formulas']").is(":checked")?($(".formula").show(),RefreshFillers("1",!0)):($(".formula").hide(),RefreshFillers("1",!0))}function ToggleFormulasAsync(){expandingLevels=!1,$("input[id='Formulas']").is(":checked")?($(".filler").width(0),$(".formula").width(0),$(".formula").show(),UpdateTree("1")):($(".formula").hide(),UpdateTree("1"))}function ToggleHiddenFields(){expandingLevels=!1,$("input[id='HiddenFields']").is(":checked")?ShowNodes("1"):HideNodes("1")}function ToggleDescription(){if(expandingLevels=!1,descriptionhidden=!descriptionhidden,$("#description").toggle(),"right"==$("#container").css("float")?($("#container").css("float","left"),$("#container").css("width","100%")):($("#container").css("float","right"),$("#container").css("width","60%")),"left"==$("#container").css("float")?$("#hr").css("width","100%"):$("#hr").css("width","59.5%"),RefreshFillers(1,!0),!descriptionhidden){let e=document.getElementById("Iframe15"),i=e.contentDocument||e.contentWindow.document;i.location=i.location}}function ToggleDescriptionAsync(){if(expandingLevels=!1,descriptionhidden=!descriptionhidden,$("#description").toggle(),"right"==$("#container").css("float")?($("#container").css("float","left"),$("#container").css("width","100%")):($("#container").css("float","right"),$("#container").css("width","60%")),"left"==$("#container").css("float")?$("#hr").css("width","100%"):$("#hr").css("width","59.5%"),$(".filler").width(0),$(".formula").width(0),UpdateTree("1"),!descriptionhidden){let e=document.getElementById("Iframe15"),i=e.contentDocument||e.contentWindow.document;i.location=i.location}}function ToggleCompact(){if(expandingLevels=!1,$("input[id='Compact']").is(":checked")){$("#container li").filter((function(){let e=$(this).parent().attr("id");return null!=e&&"Decision"==$("input[id='nodetype_"+e.replace(/li_ul_/g,"")+"']").attr("value")&&!$(this).children(":checkbox").is(":checked")&&1==$(this).siblings().children("input:checked").length})).hide()}else{let e=$("#container li").filter((function(){return"none"==$(this).css("display")&&"false"==$("input[id='ishidden_"+$(this).attr("id").replace(/li_/g,"")+"']").attr("value")}));e.show();for(let i=0;i<e.length;i++)RefreshFillers(e[i].id.replace(/li_/g,""),!1)}}function ToggleId(){$("input[id='Id']").is(":checked")?ShowIds():HideIds()}function ShowIds(){$(".id").show()}function HideIds(){$(".id").hide()}function EnlargeFillers(e){let i="li[id='li_"+e+"']";$(i).children(".filler").css("width",$(i).children(".filler").width()+$(i).children("a").children(".formula").width());let n=$(i).children("ul").children("li");if(n&&n.length>0)for(let e=0;e<n.length;e++)EnlargeFillers(n[e].id.replace(/li_/g,""))}function ShortenFillers(e){let i="li[id='li_"+e+"']";$(i).children(".filler").css("width",$(i).children(".filler").width()-$(i).children("a").children(".formula").width());let n=$(i).children("ul").children("li");if(n&&n.length>0)for(let e=0;e<n.length;e++)ShortenFillers(n[e].id.replace(/li_/g,""))}function Refill(){RefreshFillers(1,!0)}function RefreshFillers(e,i){let n="li[id='li_"+e+"']";if($(n).length){$(n).width($("#container").width()-($(n).offset().left-$("#container").offset().left));let t=$(n).children("a").children(".name").text(),d=$(n).children("a").children(".formula").children("i").text(),l=$(n).children(".subtotal").children("font").eq(0).text(),o=$(n).children(".subtotal").children("font").eq(1).text();$(n).children("a").empty(),$(n).children("a").append("<span class='name' id='name_"+e+"'>"+t+"</span>"),$(n).children("a").append("<span class='formula' id='formula_"+e+"' >"+("Decision"!=$("input[id='nodetype_"+e+"']").attr("value")&&"SumSet"!=$("input[id='nodetype_"+e+"']").attr("value")?" &nbsp;[<i>"+d.trim()+"</i>]":"")+"</span>"),$("input[id='Formulas']").is(":checked")||$(n).children("a").children(".formula").hide(),$(n).children(".subtotal").remove(),$(n).children(".filler").remove();let a,r,c,s,p,h,u,f,g,m,v,_=$("<div class='filler'>&nbsp;</div>"),w=$("<span class='subtotal' id='subtotal_"+e+"'><font size='1'>"+l+"</font> <font>"+o+"</font></span>");$(n).children("a").after(_),$(n).children("a").after(w),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&"rgb(255, 0, 0)"!=$(n).children("a").css("color")&&"rgb(0, 128, 0)"!=$(n).children("a").css("color")&&$(n).children("a").attr("style","color:gray;"),window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches&&"rgb(255, 0, 0)"!=$(n).children("a").css("color")&&"rgb(0, 128, 0)"!=$(n).children("a").css("color")&&$(n).children("a").attr("style","color:black;"),u=$("input[id='ckbx_"+e+"']").length?13:0,h=$(n).children("img").first().is(":visible")?16:0,f=$(n).children(".edit").length?$(n).children(".edit").outerWidth(!0):0,g=$(n).children(".add").length?$(n).children(".add").outerWidth(!0):0,m=$(n).children(".remove").length?$(n).children(".remove").outerWidth(!0):0;let y=$(n).children("a").children(".formula"),b=$(n).children("a").children(".name");if($(n).width($("#container").width()-($(n).offset().left-$("#container").offset().left)),a=$(n).width(),r=$(n).children("a").width(),c=$(n).children(".subtotal").width(),s=$(n).children("ins").width(),"none"==y.css("display")?(y.show(),p=y.width(),y.hide()):p=y.width(),v=b.width(),r+c+s+u+h+f+g+m+25>a){let e=r+c+s+u+h+f+g+m+25-a;p>=e+25?y.width(p-e-25):(y.width(0),b.width(v-(e-p)))}else y.width(p+5),b.width(v+5);let x=getScrollbarWidth(document.getElementById("container"));if($(n).children(".filler").css("width",a-r-c-s-u-h-f-g-m-30-x),$(n).children(".filler").css("margin-right",c+x),1==i){let e=$(n).children("ul").children("li");if(e&&e.length>0)for(let i=0;i<e.length;i++)RefreshFillers(e[i].id.replace(/li_/g,""),!0)}}$("input[id='Subtotals']").is(":checked")||$(".subtotal, .filler").hide()}function OpenNode(e){let i=e.split(">"),n="li[id='li_1']";for(let e=0;e<i.length;e++)top.asynchronous=!1,$.jstree._reference(n).open_node(n,(function(){if(e==i.length-1)$.jstree._reference("li[id='li_<%=Model.id%>']").deselect_node("li[id='li_<%=Model.id%>']"),$.jstree._reference(n).select_node(n),$("html").scrollTop($(n).offset().top);else{let t=$(n).children("ul").children("li");for(let d=0;d<t.length;d++)if($(t[d]).children("a").children("font:first").text()==i[e+1]){n="li[id='"+$(t[d]).attr("id")+"']";break}}}));top.asynchronous=!0}function ExpandLevels(e,i){0!=i&&(asynchronous=!1,$.jstree._reference("li[id='li_"+e+"']").open_node("li[id='li_"+e+"']",(function(){let n=$("li[id='li_"+e+"']").children("ul").children("li");if(n&&n.length>0)for(let e=0;e<n.length;e++)ExpandLevels(n[e].id.replace(/li_/g,""),i-1)})),asynchronous=!0)}function ExpandLevels2(e,i){if(expandingLevels=!0,0!=i){let n=$("li[id='li_"+e+"']").children("ul");if(0==n.length||0==n.children("li").length)$.ajax({url:"ChildNodes?id="+e,type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(e){let n=jQuery.parseJSON(e.responseText);for(let e=0;e<n.length;e++)ExpandLevels2(n[e].id,i-1)},success:function(i){Assemble(i,"li_"+e),$("#container").jstree("open_node",$("li[id='li_"+e+"']"))}});else{$("#container").jstree("open_node",$("li[id='li_"+e+"']")),RefreshFillers(e,!0);let n=$("li[id='li_"+e+"']").children("ul").children("li");for(let e=0;e<n.length;e++)ExpandLevels2(n[e].id.replace(/li_/g,""),i-1)}}}function SetUnits(){$("#inodeUnitsText").val($("#inodeUnits").val()),$("#newinodeUnitsText").val($("#newinodeUnits").val())}function FillNodeDialogInfo(e){asynchronous=!1,$.ajax({url:"NodeInfo?id="+e,type:"GET",dataType:"json",async:!1,cache:!1,beforeSend:function(){},complete:function(){},success:function(e){$("#inodeName").val(e.name),$("#inodeType").val(e.type),"Decision"==e.type||"SumSet"==e.type?($("#inodeExpression").attr("disabled","disabled"),$("#inodeExpression").val("")):"Date"==e.type||"Today"==e.type?($("#inodeExpression").attr("disabled","disabled"),$("#inodeExpression").val(e.expression)):($("#inodeExpression").removeAttr("disabled"),$("#inodeExpression").val(e.expression)),$("#inodeExpandedLevels").val(e.expandedLevels),$("#inodeOrder").val(e.order),$("#inodeMin").val(e.min),$("#inodeMax").val(e.max),$("#inodeDiscount").val(e.discount),$("#inodeHidden").prop("checked",e.hidden),$("#inodeOptional").prop("checked",e.optional),$("#inodeDisable").val(e.disableCondition),$("#inodeDisabledMessage").val(e.disabledMessage),e.parentIsDecision?$("#inodeOptional").prop("disabled",!0):$("#inodeOptional").prop("disabled",!1),$("#inodeEditChildren").prop("checked",e.editChildren),$("#inodeReport").prop("checked",e.report),$("#inodeReportValue").prop("checked",e.reportValue),$("#inodeUnits").val(e.units),$("#inodeDecimalPlaces").val(e.decimalPlaces),$("#inodeUnitsText").val(e.units),$("#inodeTemplate").prop("checked",e.template),$("#inodeReadOnly").prop("checked",e.readOnly)}}),asynchronous=!0}function SaveNodeInfo(){let e=$("#inodeName").val(),n=$("#inodeType").val(),t=$("#inodeExpression").val(),d=$("#inodeExpandedLevels").val(),l=$("#inodeOrder").val(),o=$("#inodeMin").val(),a=$("#inodeMax").val(),r=$("#inodeDiscount").val(),c=$("#inodeHidden").is(":checked"),s=$("#inodeOptional").is(":checked"),p=$("#inodeDisable").val(),h=$("#inodeDisabledMessage").val(),u=$("#inodeEditChildren").is(":checked"),f=$("#inodeReport").is(":checked"),g=$("#inodeReportValue").is(":checked"),m=$("#inodeUnitsText").val(),v=$("#inodeDecimalPlaces").val(),_=$("#inodeTemplate").is(":checked"),w=$("#inodeReadOnly").is(":checked"),y="*/\\+-|[]?&!()><=#{};:,_";if(0==function(e){for(i=0;i<y.length;i++)if(e.indexOf(y[i])>-1)return!0;return!1}(e)){let i="id="+editedNodeId+"&name="+e+"&type="+n+"&expression="+encodeURIComponent(t)+"&expandedLevels="+d+"&order="+l+"&min="+o+"&max="+a+"&discount="+r+"&hidden="+c+"&optional="+s+"&disable="+encodeURIComponent(p)+"&disabledMessage="+encodeURIComponent(h)+"&editChildren="+u+"&report="+f+"&reportValue="+g+"&units="+encodeURI(m)+"&decimalPlaces="+v+"&template="+_+"&readOnly="+w,y=$("#inodeName").serialize();overlay=$("<div></div>").prependTo("body").attr("id","overlay"),$("#overlay").show(),$(".loading").show(),$.ajax({url:"SaveNodeInfo?"+i,type:"GET",data:y,dataType:"json",async:!1,timeout:12e4,cache:!1,beforeSend:function(){},error:function(){alert("Couldn't save node. Either the name is empty or a node with the same name already exists."),$(".loading_dependencies").hide(),$("#overlay").remove(),editdialog.dialog("close")},complete:function(){},success:function(e){if(1!=editedNodeId){let i=$("li[id='li_"+editedNodeId+"']").parent().attr("id").replace(/li_ul_/g,"");$.jstree._reference("li[id='li_"+i+"']").move_node("li[id='li_"+editedNodeId+"']","li[id='li_"+i+"']",parseInt(e.order))}price=document.getElementById("price"),$(price).text("Total: "+e.total),e.hasErrors?(alert(e.error),UpdateTreeSync(),$(".loading_dependencies").hide(),$("#overlay").remove()):(UpdateTreeSync(),$(".loading_dependencies").hide(),$("#overlay").remove(),editdialog.dialog("close"))}}),top.asynchronous=!0}else alert("The name contains illegal characters.")}function NewNode(){let e=$("#newinodeName").val(),n=$("#newinodeType").val(),t=$("#newinodeExpression").val(),d=$("#newinodeExpandedLevels").val(),l=$("#newinodeOrder").val(),o=$("#newinodeMin").val(),a=$("#newinodeMax").val(),r=$("#newinodeDiscount").val(),c=$("#newinodeHidden").is(":checked"),s=$("#newinodeOptional").is(":checked"),p=$("#newinodeDisable").val(),h=$("#newinodeDisabledMessage").val(),u=$("#newinodeEditChildren").is(":checked"),f=$("#newinodeReport").is(":checked"),g=$("#newinodeReportValue").is(":checked"),m=$("#newinodeUnitsText").val(),v=$("#newinodeDecimalPlaces").val(),_=$("#newinodeTemplate").is(":checked"),w=$("#newinodeReadOnly").is(":checked"),y="*/\\+-|[]?&!()><=#{};:,_";if(0==function(e){for(i=0;i<y.length;i++)if(e.indexOf(y[i])>-1)return!0;return!1}(e)){let i="id="+addToNodeId+"&name="+e+"&type="+n+"&expression="+encodeURIComponent(t)+"&expandedLevels="+d+"&order="+l+"&min="+o+"&max="+a+"&discount="+r+"&hidden="+c+"&optional="+s+"&disable="+encodeURIComponent(p)+"&disabledMessage="+encodeURIComponent(h)+"&editChildren="+u+"&report="+f+"&reportValue="+g+"&units="+encodeURI(m)+"&decimalPlaces="+v+"&template="+_+"&readOnly="+w,y=$("#inodeName").serialize();overlay=$("<div></div>").prependTo("body").attr("id","overlay"),$("#overlay").show(),$(".loading").show(),$.ajax({url:"NewNode?"+i,type:"GET",data:y,dataType:"json",async:!0,cache:!1,timeout:72e5,beforeSend:function(){},complete:function(){UpdateTreeSync(),$(".loading_dependencies").hide(),$("#overlay").remove(),creatingNewNode=!1},error:function(){alert("Couldn't insert the new node."),$(".loading_dependencies").hide(),$("#overlay").remove(),creatingNewNode=!1},success:function(e){e.hasErrors?alert(e.error):null!=e&&(creatingNewNode=!0,""!=addToNodeId?($("#container").jstree("create",null,parseInt(e.order),{data:" ",attr:{class:"jstree-closed",id:"li_"+e.id}},!1,!0),$("li[id='li_"+e.id+"']").children("a").remove(),null==$("li[id='li_"+e.id+"']").parent().attr("id")&&$("li[id='li_"+e.id+"']").parent().attr("id","li_ul_"+addToNodeId),UpdateNode(e)):($("#container").jstree("create",null,parseInt(e.order),{data:" ",attr:{class:"jstree-closed",id:"li_"+e.id}},!1,!0),UpdateNodeFromServer("1")),$("#newinodeName").val(""),$("#newinodeType").val("Math"),$("#newinodeExpression").val(""),$("#newinodeExpandedLevels").val(""),$("#newinodeOrder").val(""),$("#newinodeMin").val(""),$("#newinodeMax").val(""),$("#newinodeDiscount").val(""),$("#newinodeHidden").attr("checked",!1),$("#newinodeOptional").attr("checked",!1),$("#newinodeEditChildren").attr("checked",!1),$("#newinodeReport").attr("checked",!1),$("#newinodeReportValue").attr("checked",!1),$("#newinodeUnits").val(""),$("#newinodeDecimalPlaces").val(""),newnodedialog.dialog("close"))}})}else alert("The name contains illegal characters.")}function removeNodes(){$.ajax({url:"removeNodes?ids="+removeNodeIds,type:"GET",async:!1,dataType:"text",cache:!1,beforeSend:function(){},complete:function(){removenodedialog.dialog("close")},success:function(e){if(""!=e){price=document.getElementById("price"),$(price).text("Total: "+e);let i=removeNodeIds.split(";");for(let e=0;e<i.length;e++)if(""!=i[e]){let n=$("li[id='li_"+i[e]+"']").parent().attr("id");"Decision"==$("input[id='nodetype_"+n.replace(/li_ul_/g,"")+"']").attr("value")&&$("li[id='li_"+i[e]+"']").siblings().show(),$("li[id='li_"+i[e]+"']").remove()}UpdateTree(1)}else alert("Some nodes could not be removed.")}})}function Assemble(e,i){let n=i;$(i).children("ul");$("#container").jstree("select_node",$("li[id='"+n+"']"));for(let i=0;i<e.length;i++){$("#container").jstree("create",null,"last",{data:" ",attr:{class:"jstree-closed",id:"li_"+e[i].id}},!1,!0),UpdateNode(e[i]),1!=e[i].hidden||$("input[id='HiddenFields']").is(":checked")||$("li[id='li_"+e[i].id+"']").hide();let n=e[i].url;$("li[id='li_"+e[i].id+"']").children("a").attr("href",n),$("li[id='li_"+e[i].id+"']").children("a").attr("target","details"),$("li[id='li_"+e[i].id+"']").children("a").attr("title",e[i].expression)}$("li[id='"+n+"']").children("ul").attr("id","li_ul_"+n.replace(/li_/g,"")),$("#container").jstree("deselect_node",$("li[id='"+n+"']"))}function RenderTree(e){let i=e.Id.substr(0,e.Id.lastIndexOf("."));1!=e.Id&&$("#container").jstree("select_node",$("li[id='li_"+i+"']")),$("#container").jstree("create",null,"last",{data:" ",attr:{class:"jstree-closed",id:"li_"+e.Id}},!1,!0);let n="li[id='li_"+e.Id+"']";if($(n).length){let i,t;$(n).css("white-space","normal"),$(n).width($("#container").width()-($(n).offset().left-$("#container").offset().left)),$("input[id='ckbx_"+e.Id+"']").remove(),e.Optional&&(i=1==e.Selected?"checked":"",t="<input type='checkbox' ",e.Disabled&&($(n).siblings().show(),t+="disabled='true'"),t+=" id='ckbx_"+e.Id+"' style='padding:0px 0px 0px 0px; margin:0px 0px 0px 2px;' onchange='CheckBoxClickHandler(this, true);' "+i+"/>",$(n).children("ins").after(t)),t="<img src='../Images/blinkcircle.gif' class='incomplete' style='display: none;' height='14' width='14'>",$(n).children(".incomplete").remove(),$(n).children("ins").after(t),e.Complete||e.Optional&&!e.Selected?$(n).children(".incomplete").hide():$(n).children(".incomplete").show();let d="../"+e.Url;$(n).children("a").attr("href",d),$(n).children("a").attr("target","details"),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&"rgb(255, 0, 0)"!=$(n).children("a").css("color")&&"rgb(0, 128, 0)"!=$(n).children("a").css("color")&&$(n).children("a").attr("style","color:gray;"),window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches&&"rgb(255, 0, 0)"!=$(n).children("a").css("color")&&"rgb(0, 128, 0)"!=$(n).children("a").css("color")&&$(n).children("a").attr("style","color:black;"),e.Leaf&&$("li[id='li_"+e.Id+"']").children("a").attr("style","color:red;"),e.Hidden&&$("li[id='li_"+e.Id+"']").children("a").attr("style","color:green");let l="";l="Decision"!=e.TypeStr&&"SumSet"!=e.TypeStr&&"Text"!=e.TypeStr||"Text"==e.TypeStr?"&nbsp;[<i>"+e.Expression+"</i>]":" &nbsp;&nbsp;&nbsp;",$(n).children("a").attr("title",e.Expression),t="<input type='hidden' id='nodetype_"+e.Id+"' value='"+e.TypeStr+"'/> ",$("li[id='li_"+e.Id+"']").append(t),t="<input type='hidden' id='ishidden_"+e.Id+"' value='"+e.Hidden+"'/> ",$("li[id='li_"+e.Id+"']").append(t),t="<input type='hidden' id='isoptional_"+e.Id+"' value='"+e.Optional+"'/> ",$("li[id='li_"+e.Id+"']").append(t),t="<input type='hidden' id='dependents_"+e.Id+"' value='"+e.DependentsStr+"'/> ",$("li[id='li_"+e.Id+"']").append(t),t="<input type='hidden' id='editchildren_"+e.Id+"' value='"+e.EditChildren+"'/> ",$("li[id='li_"+e.Id+"']").append(t),t="<input type='hidden' id='expandedlevels_"+e.Id+"' value='"+e.ExpandedLevels+"'/> ",$("li[id='li_"+e.Id+"']").append(t),$(n).children("a").append("<span class='name' id='name_"+e.Id+"'>"+e.Name+"</span>"),$(n).children("a").append("<span class='formula' id='formula_"+e.Id+"' > "+l.trim()+"</span>"),$("input[id='Formulas']").is(":checked")||$(n).children("a").children(".formula").hide(),$(n).children(".subtotal").remove(),$(n).children(".filler").remove(),$(n).children(".edit").remove(),$(n).children(".add").remove(),$(n).children(".remove").remove();let o,a,r,c,s,p,h,u,f,g,m,v=$("<div class='filler'>&nbsp;</div>"),_=$("<span class='subtotal' id='subtotal_"+e.Id+"'><font size='1'>"+e.TypeStr+"</font>  <font>["+e.TotalStr+"]</font></span>");$(n).children("a").after(v),$(n).children("a").after(_),$(n).children("a").after("<span title='Remove node' id='remove_"+e.Id+"' class='remove' ></span>"),$(n).children("a").after("<span title='Add node' id='add_"+e.Id+"' class='add'></span>"),$(n).children("a").after("<span title='Edit: "+e.Name+"' id='edit_"+e.Id+"' class='edit'></span>"),$(n).children("a").next().on("click",(function(i){i.preventDefault();let t="li[id='li_"+e.Id+"']";descriptionhidden||$(t).children("a").click(),editedNodeId=e.Id,$("#inodeOrder").empty();for(let e=0;e<=$(n).siblings().length;e++)$("#inodeOrder").append("<option  value='"+e+"'>"+e+"</option>");FillNodeDialogInfo(editedNodeId),editdialog.dialog("option","title",'Edit: "'+e.Name+'"'),editdialog.dialog("open"),$.ajax({url:"getAllNames",type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){allNames.length=0;for(let i of e)allNames.push(i)}})})),$(n).children(".remove").on("click",(function(i){i.preventDefault(),removeNodeIds=e.Id,$("#removeNode").children("label").text('Remove "'+e.Name+'"?'),removenodedialog.dialog("open")})),$(n).children(".add").on("click",(function(i){i.preventDefault();let t="li[id='li_"+e.Id+"']";descriptionhidden||$(t).children("a").click(),addToNodeId=e.Id,"Decision"==$("input[id='nodetype_"+e.Id+"']").attr("value")?($("#newinodeOptional").prop("checked",!0),$("#newinodeOptional").attr("disabled","disabled")):($("#newinodeOptional").prop("checked",!1),$("#newinodeOptional").attr("disabled",!1)),$("#newinodeOrder").empty();for(let e=0;e<=$(n).children("ul").children("li").length;e++)$("#newinodeOrder").append("<option  value='"+e+"'>"+e+"</option>");newnodedialog.dialog("option","title",'Insert new node into: "'+e.Name+'"'),newnodedialog.dialog("open"),$.ajax({url:"getAllNames",type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){allNames.length=0;for(let i of e)allNames.push(i)}})})),h=$("input[id='ckbx_"+e.Id+"']").length?13:0,p=$(n).children("img").first().is(":visible")?16:0,u="Decision"!=e.TypeStr?$(n).children(".edit").outerWidth(!0):0,f=$(n).children(".add").outerWidth(!0),g=$(n).children(".remove").outerWidth(!0);let w=$(n).children("a").children(".formula"),y=$(n).children("a").children(".name");if($(n).width($("#container").width()-($(n).offset().left-$("#container").offset().left)),o=$(n).width(),a=$(n).children("a").width(),r=$(n).children(".subtotal").width(),c=$(n).children("ins").width(),"none"==w.css("display")?(w.show(),s=w.width(),w.hide()):s=w.width(),m=y.width(),0==w.children("i").length&&(s=0),a+r+c+h+p+u+f+g+25>o){let e=a+r+c+h+p+u+f+g+25-o;s>=e+25?w.width(s-e-25):(w.width(0),y.width(m-(e-s)))}else w.width(s+5),y.width(m+5);let b=getScrollbarWidth(document.getElementById("container"));$(n).children(".filler").css("width",o-a-r-c-h-p-u-f-g-30-b),$(n).children(".filler").css("margin-right",r+b);let x=$("li[id='li_1']").position().left;$("<font width='100%' size='1' class='id' id = 'id_"+e.Id+"'>&nbsp"+e.Id+"</font>").insertBefore("li[id='li_"+e.Id+"']>ins"),$(".id").css({position:"absolute",left:x});let I=$("font[id='id_"+e.Id+"']").width(),N=$(n).children("ins").position().left;I>N?$(n).css("margin-left",I-N+13.5):$(n).css("margin-left",13.5),$("input[id='Subtotals']").is(":checked")||$(".subtotal, .filler").hide(),0==$(n).children("ul").length&&$(n).append("<ul id='li_ul_"+e.Id+"' style='display:inline'></ul>")}if(null!=e._Children)for(let i=0;i<e._Children.length;i++)null!=e._Children[i].Id&&RenderTree(e._Children[i]);$("#container").jstree("deselect_node",$("li[id='li_"+i+"']"))}function SaveDefinition(){overlay=$("<div></div>").prependTo("body").attr("id","overlay"),$("#overlay").show(),$(".loading").show(),$.ajax({url:"SaveDefinition",type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){$(".loading_dependencies").hide(),$("#overlay").remove()},success:function(){}})}function PruneTree(e,i){let n=e.Id.split(".").length-1;if("1"==e.Id||n!=i.ExpandedLevels)for(let n=0;n<e._Children.length;n++)PruneTree(e._Children[n],i);else e._Children=null}function lzw_decode(e){let i,n={},t=(e+"").split(""),d=t[0],l=d,o=[d],a=256;for(let e=1;e<t.length;e++){let r=t[e].charCodeAt(0);i=r<256?t[e]:n[r]?n[r]:l+d,o.push(i),d=i.charAt(0),n[a]=l+d,a++,l=i}return o.join("")}function replaceLastOccurrence(e,i,n){const t=e.lastIndexOf(i);if(-1===t)return e;return e.slice(0,t)+n+e.slice(t+i.length)}$((function(){function e(e){return e.split(/[()*/%+-?&!><=:,]+/g)}descriptionhidden=!1,ajaxDone=!1,asynchronous=!0,mobile=!1,copyNodesId="",treeIsLoaded=!1,expandingLevels=!1,creatingNewNode=!1,allNames=[],dialogHeight=98*window.innerHeight/100,$("#container").jstree({plugins:["themes","html_data","ui","crrm","contextmenu"],contextmenu:{items:function(e){return{Edit:{label:"Edit",action:function(e){nodeId=e.attr("id").replace(/li_/g,""),$("span[id='edit_"+nodeId+"']").click()}},Add:{label:"Add",action:function(e){nodeId=e.attr("id").replace(/li_/g,""),$("span[id='add_"+nodeId+"']").click()}},Remove:{label:"Remove",action:function(e){removeNodeIds="";let i=$("#container").jstree("get_selected");if(i.length>1){for(let e=0;e<i.length;e++)removeNodeIds+=i[e].id.replace(/li_/g,"")+";";$("#removeNode").children("label").text("Remove multiple nodes?"),removenodedialog.dialog("open")}else nodeId=e.attr("id").replace(/li_/g,""),$("span[id='remove_"+nodeId+"']").click()}},Copy:{label:"Copy",action:function(e){copyNodesId="";let i=$("#container").jstree("get_selected");if(this.copy(i),i.length<=1)copyNodesId=e.attr("id").replace(/li_/g,"");else for(let e=0;e<i.length;e++)copyNodesId+=i[e].id.replace(/li_/g,"")+";"}},Paste:{label:"Paste",action:function(e){let i=e.attr("id").replace(/li_/g,"");null!=copyNodesId&&""!=copyNodesId&&(overlay=$("<div></div>").prependTo("body").attr("id","overlay"),$("#overlay").show(),$(".loading").show(),$.ajax({url:"cloneNodes?sourceId="+copyNodesId+"&targetId="+i,type:"GET",async:!0,dataType:"json",cache:!1,beforeSend:function(){},complete:function(){$(".loading_dependencies").hide(),$("#overlay").remove(),creatingNewNode=!1},error:function(){alert("An error occurred while copying the node."),$(".loading_dependencies").hide(),$("#overlay").remove(),creatingNewNode=!1},success:function(n){for(let t=0;t<n.length;t++)creatingNewNode=!0,$("#container").jstree("create",e,parseInt(n[t].order),{data:" ",attr:{class:"jstree-closed",id:"li_"+n[t].id}},!1,!0),$("li[id='li_"+n[t].id+"']").children("a").remove(),null==$("li[id='li_"+n[t].id+"']").parent().attr("id")&&$("li[id='li_"+n[t].id+"']").parent().attr("id","li_ul_"+i),UpdateNode(n[t]);UpdateTreeSync(),$("#container").jstree("deselect_all"),price=document.getElementById("price"),$(price).text("Total: "+n[0].total)}}))}}}}},themes:{theme:"default",dots:!1,icons:!1}}).bind("loaded.jstree",(function(e,i){ExpLevels=0,$.ajax({url:"getJson",type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){if(null!=e){let i=JSON.parse(e);PruneTree(i,i),RenderTree(i),RefreshFillers(1,!1),treeIsLoaded=!0}else addToNodeId="",$("#newinodeOrder").empty(),$("#newinodeOrder").append("<option  value='0'>0</option>"),newnodedialog.dialog("option","title","Insert first node"),newnodedialog.dialog("open"),newnodedialog.closest("div.ui-dialog").find("button.ui-dialog-titlebar-close").click((function(e){$("#li_1").children("a").length||(document.location="../Home/Index"),e.preventDefault()}));descriptionOffsetTop=$("#description").offset().top,$("#Iframe15").height($(window).height()-descriptionOffsetTop-70),$("#container").height($(window).height()-descriptionOffsetTop-40)}})})),$("#container").bind("open_node.jstree",(function(e,i){let n=i.rslt.obj.attr("id"),t=i.rslt.obj.find("ul");$("input[id='HiddenFields']").is(":checked")||HideNodes(n.replace(/li_/g,""),""),show_all=-1!=document.location.href.search("true")?"true":"false",0==t.length||0==$(t).children("li").length?asynchronous?$.ajax({url:"ChildNodes?id="+n,type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(e){},success:function(e){Assemble(e,n)}}):$.ajax({url:"ChildNodes?id="+n,type:"GET",dataType:"json",async:!1,cache:!1,beforeSend:function(){},complete:function(e){},success:function(e){Assemble(e,n)}}):!treeIsLoaded||expandingLevels||creatingNewNode||RefreshFillers(n.replace(/li_/g,""),!0)})),$("#container").bind("select_node.jstree",(function(e,i){i.args[0].href&&(document.getElementById("Iframe15").src=i.args[0].href)})),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(mobile=!0),$("textarea").on("keydown",(function(e){e.keyCode===$.ui.keyCode.TAB&&$(this).autocomplete("instance").menu.active&&e.preventDefault()})).autocomplete({minLength:0,source:function(i,n){n($.ui.autocomplete.filter(allNames,e(i.term).pop().trimLeft().trimRight()))},focus:function(){return!1},select:function(i,n){let t=e(this.value);return this.value=replaceLastOccurrence(this.value,t[t.length-1],"")," "!=n.item.value[0]&&(n.item.value=" "+n.item.value)," "!=n.item.value[n.item.value.length-1]&&(n.item.value=n.item.value+" "),this.value=this.value+n.item.value,!1}}),$(window).on("resize",(function(){let e=editdialog.dialog("isOpen"),n=newnodedialog.dialog("isOpen"),t=dialog.dialog("isOpen");if(dialogHeight=98*window.innerHeight/100,editdialog.dialog("close"),newnodedialog.dialog("close"),dialog.dialog("close"),editdialog=$("#inodeInfo").dialog({autoOpen:!1,modal:!0,resizable:!1,width:"auto",height:"auto",maxHeight:dialogHeight,title:"Edit node",close:function(){$(".loading_dependencies").hide(),$("#overlay").remove()},buttons:{Save:function(){return SaveNodeInfo(),!1}}}).css({overflow:"auto"}),newnodedialog=$("#inewnodeInfo").dialog({autoOpen:!1,modal:!0,resizable:!1,width:"auto",height:"auto",maxHeight:dialogHeight,title:"Insert new node",close:function(){},buttons:{Save:function(){NewNode()}}}).css({overflow:"auto"}),dialog=$("<div></div>").append(i).appendTo("body").dialog({autoOpen:!1,modal:!0,resizable:!1,width:"auto",height:"auto",maxHeight:dialogHeight,title:"Description",close:function(){i.attr("src","about:blank")}}).css({overflow:"auto"}),e&&editdialog.dialog("open"),n&&newnodedialog.dialog("open"),$(window).width()<"1024"&&$("input[id='Description']").is(":checked")&&(descriptionOffsetTop=$("#description").offset().top,$("input[id='Description']").click()),$(window).width()>="1024"&&!$("input[id='Description']").is(":checked")?($("input[id='Description']").click(),descriptionOffsetTop=$("#description").offset().top):$("input[id='Description']").is(":checked")&&(descriptionOffsetTop=$("#description").offset().top),$("#description").is(":hidden")&&t){let e=document.getElementById("Iframe15").contentWindow.location.href,n=mobile?"100%":40*$("#hr").width()/100,t=n;i.attr({width:+n,height:+t,src:e}),dialog.dialog("open")}Refill(),containerOffsetTop=$("#container").offset().top,$("#Iframe15").height($(window).height()-descriptionOffsetTop-70),$("#container").height($(window).height()-containerOffsetTop)}));let i=$('<iframe style="border:0;" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>');dialog=$("<div></div>").append(i).appendTo("body").dialog({autoOpen:!1,modal:!0,resizable:!1,width:"auto",height:"auto",maxHeight:dialogHeight,title:"Description",close:function(){i.attr("src","about:blank")}}).css({overflow:"auto"}),$("#Iframe15").on("load",(function(e){if(descriptionhidden){e.preventDefault();let n=document.getElementById("Iframe15").contentWindow.location.href,t=mobile?"100%":40*$("#hr").width()/100,d=t;i.attr({width:+t,height:+d,src:n}),dialog.dialog("open")}})),editdialog=$("#inodeInfo").dialog({autoOpen:!1,modal:!0,resizable:!1,width:"auto",height:"auto",maxHeight:dialogHeight,title:"Edit node",close:function(){$(".loading_dependencies").hide(),$("#overlay").remove()},buttons:{Save:function(){return SaveNodeInfo(),!1}}}).css({overflow:"auto"}),newnodedialog=$("#inewnodeInfo").dialog({autoOpen:!1,modal:!0,resizable:!1,width:"auto",height:"auto",maxHeight:dialogHeight,title:"Insert new node",close:function(){},buttons:{Save:function(){NewNode()}}}).css({overflow:"auto"}),removenodedialog=$("#removeNode").dialog({autoOpen:!1,modal:!0,resizable:!1,width:"auto",height:"auto",close:function(){},buttons:{Remove:function(){removeNodes()}}}),$(window).width()<"1024"&&$("input[id='Description']").click(),document.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1)}));