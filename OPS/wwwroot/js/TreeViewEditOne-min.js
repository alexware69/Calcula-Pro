function CheckBoxClickHandler(e,i){var n=e.id,d=n.replace(/ckbx_/g,""),t=$("input[id='"+n+"']").parent().attr("id"),l=t.replace(/li_/g,""),o=$("li[id='"+t+"']").parent().attr("id");if("Decision"==$("input[id='nodetype_"+o.replace(/li_ul_/g,"")+"']").attr("value")&&(e.checked&&$("input[id='Compact']").is(":checked")?$("li[id='"+t+"']").siblings().hide():($("li[id='"+t+"']").siblings().show(),$("li[id='"+t+"']").siblings().each((function(){RefreshFillers(this.id.replace(/li_/g,""),!1)})))),asynchronous=!1,e.checked&&0==$("ul[id='li_ul_"+d+"']").children().length?$.jstree._reference("li[id='li_"+d+"']").open_node("li[id='li_"+d+"']"):(!e.checked&&$("input[id='Compact']").is(":checked")&&$("#container").jstree("close_node",$("li[id='li_"+d+"']")),e.checked&&$("#container").jstree("open_node",$("li[id='li_"+d+"']"))),asynchronous=!0,e.checked){for(var a=$("li[id='"+t+"']").parent("ul").parent("li");"li_1"!=a.attr("id")&&(!$("input[id='ckbx_"+a.attr("id").replace(/li_/g,"")+"']").length||$("input[id='ckbx_"+a.attr("id").replace(/li_/g,"")+"']").is(":checked"));)a=a.parent("ul").parent("li");"li_1"!=a.attr("id")&&($("input[id='ckbx_"+a.attr("id").replace(/li_/g,"")+"']").attr("checked",!0),CheckBoxClickHandler(document.getElementById("ckbx_"+a.attr("id").replace(/li_/g,"")),!1))}var r=e.checked?"true":"false";if($.ajax({url:"SetCheckboxState?id="+d+"&state="+r,type:"GET",dataType:"json",async:!1,cache:!1,beforeSend:function(){},complete:function(){},success:function(e){$("#price").text("Total: "+e.total);for(var i=";"+$("input[id='dependents_"+l+"']").attr("value"),n=GetBranch(l).split(";"),d=0;d<n.length;d++)-1==i.indexOf(";"+n[d]+";")&&(i=i+";"+n[d]);var o=$("li[id='"+t+"']").find("li");for(d=0;d<o.length;d++)i+=";"+o[d].id.replace(/li_/g,"");UpdateNodesFromServer(i)}}),e.checked&&"Decision"==$("input[id='nodetype_"+o.replace(/li_ul_/g,"")+"']").attr("value")){var c=$("li[id='"+t+"']").siblings().children("input:checked");if(0!=c.length){for(var s=";"+c[0].id.replace(/ckbx_/g,""),h=$("li[id='li_"+c[0].id.replace(/ckbx_/g,"")+"']").find("li").filter((function(){return"false"==$("input[id='isoptional_"+$(this).attr("id").replace(/li_/g,"")+"']").attr("value")})),p=0;p<h.length;p++)s+=";"+h[p].id.replace(/li_/g,"");var u=";"+$("input[id='dependents_"+c[0].id.replace(/ckbx_/g,"")+"']").attr("value"),f=u.split(";");for(p=0;p<f.length;p++)-1==s.indexOf(";"+f[p]+";")&&(s=s+";"+f[p]);s+=u,asynchronous=!0,UpdateNodesFromServer(s)}}e.checked&&!descriptionhidden&&$("li[id='li_"+d+"']").children("a").click(),e.checked||"Decision"!=$("input[id='nodetype_"+o.replace(/li_ul_/g,"")+"']").attr("value")||descriptionhidden||$("li[id='li_"+o.replace(/li_ul_/g,"")+"']").children("a").click(),i&&$("input[id='"+n+"']").is(":checked")&&(asynchronous,ExpandLevels2(d,$("input[id='expandedlevels_"+d+"']").attr("value")))}function UpdateParent(e){$.ajax({url:"NodeInfo?id="+e,type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){var i=$("li[id='li_"+e.id+"']").parent().attr("id");e.complete||e.optional&&!e.selected?$("li[id='li_"+e.id+"']").children("img").first().hide():$("li[id='li_"+e.id+"']").children("img").first().show(),UpdateNode(e),"container"!=$("li[id='li_"+e.id+"']").parent().parent().attr("id")&&UpdateParent(i.replace(/li_ul_/g,""))}})}function UpdateParentSync(e){var i="";!function e(n){i+=n+";";var d="li[id='li_"+n+"']";"container"!=$(d).parent().parent().attr("id")&&(parentULID=$(d).parent().attr("id"),e(parentULID.replace(/li_ul_/g,"")))}(e),UpdateNodesFromServer(i)}function GetBranch(e){var i="";return function e(n){i+=n+";";var d="li[id='li_"+n+"']";"container"!=$(d).parent().parent().attr("id")&&e($(d).parent().attr("id").replace(/li_ul_/g,""))}(e),i}function BuildDependencies(){overlay=$("<div></div>").prependTo("body").attr("id","overlay"),$("#overlay").show(),$.ajax({url:"BuildDependencies",type:"GET",dataType:"json",async:!0,cache:!1,beforeSend:function(){},complete:function(){$(".loading_dependencies").hide(),$("#overlay").remove()},success:function(e){2==e.length&&alert('Circular reference between nodes: "'+e[0].name+'" and "'+e[1].name+'"'),price=document.getElementById("price"),$(price).text("Total: "+e[0].total),UpdateTreeSync()}})}function getScrollbarWidth(e){return e.offsetWidth-e.clientWidth}function UpdateNode(e){var i="li[id='li_"+e.id+"']";if($(i).length){var n,d;if($(i).css("white-space","normal"),$(i).width($("#container").width()-($(i).offset().left-$("#container").offset().left)),$("input[id='ckbx_"+e.id+"']").remove(),e.optional&&(n=1==e.selected?"checked":"",d="<input type='checkbox' ",e.disabled&&($(i).siblings().show(),d+="disabled='true'"),d+=" id='ckbx_"+e.id+"' style='padding:0px 0px 0px 0px; margin:0px 0px 0px 2px;' onchange='CheckBoxClickHandler(this, true);' "+n+"/>",$(i).children("ins").after(d)),d="<img src='../Images/blinkcircle.gif' class='incomplete' style='display: none;' height='14' width='14'>",$(i).children(".incomplete").remove(),$(i).children("ins").after(d),e.complete||e.optional&&!e.selected?$(i).children(".incomplete").hide():$(i).children(".incomplete").show(),0==$(i).children("a").length){$(i).append("<a></a>");var t="../"+e.url;$(i).children("a").attr("href",t),$(i).children("a").attr("target","details")}else{t="../"+e.url;$(i).children("a").attr("href",t),$(i).children("a").attr("target","details")}window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&$(i).children("a").attr("style","color:gray;"),window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches&&$(i).children("a").attr("style","color:black;"),e.leaf&&$("li[id='li_"+e.id+"']").children("a").attr("style","color:red;"),e.hidden&&$("li[id='li_"+e.id+"']").children("a").attr("style","color:green"),$("input[id='nodetype_"+e.id+"']")&&$("input[id='nodetype_"+e.id+"']").remove(),$("input[id='ishidden_"+e.id+"']")&&$("input[id='ishidden_"+e.id+"']").remove(),$("input[id='isoptional_"+e.id+"']")&&$("input[id='isoptional_"+e.id+"']").remove(),$("input[id='dependents_"+e.id+"']")&&$("input[id='dependents_"+e.id+"']").remove(),$("input[id='editchildren_"+e.id+"']")&&$("input[id='editchildren_"+e.id+"']").remove(),$("input[id='expandedlevels_"+e.id+"']")&&$("input[id='expandedlevels_"+e.id+"']").remove(),d="<input type='hidden' id='nodetype_"+e.id+"' value='"+e.type+"'/> ",$("li[id='li_"+e.id+"']").append(d),d="<input type='hidden' id='ishidden_"+e.id+"' value='"+e.hidden+"'/> ",$("li[id='li_"+e.id+"']").append(d),d="<input type='hidden' id='isoptional_"+e.id+"' value='"+e.optional+"'/> ",$("li[id='li_"+e.id+"']").append(d),d="<input type='hidden' id='dependents_"+e.id+"' value='"+e.dependents+"'/> ",$("li[id='li_"+e.id+"']").append(d),d="<input type='hidden' id='editchildren_"+e.id+"' value='"+e.editChildren+"'/> ",$("li[id='li_"+e.id+"']").append(d),d="<input type='hidden' id='expandedlevels_"+e.id+"' value='"+e.expandedLevels+"'/> ",$("li[id='li_"+e.id+"']").append(d),$(i).children("a").empty(),$(i).children("a").append("<span class='name' id='name_"+e.id+"'>"+e.name+"</span>"),$(i).children("a").append("<span class='formula' id='formula_"+e.id+"' > "+("Decision"!=e.type&&"SumSet"!=e.type?" &nbsp;[<i>"+e.expression.trim()+"</i>]":" &nbsp;&nbsp;&nbsp;")+"</span>"),$("input[id='Formulas']").is(":checked")||$(i).children("a").children(".formula").hide(),$(i).children(".subtotal")&&$(i).children(".subtotal").remove(),$(i).children(".filler")&&$(i).children(".filler").remove(),$(i).children(".edit")&&$(i).children(".edit").remove(),$(i).children(".add")&&$(i).children(".add").remove(),$(i).children(".remove")&&$(i).children(".remove").remove();var l,o,a,r,c,s,h,p,u,f,v=$("<div class='filler'>&nbsp;</div>"),g=$("<span class='subtotal' id='subtotal_"+e.id+"'><font size='1'>"+e.type+"</font>  <font>["+e.subtotal+"]</font></span>");$(i).children("a").after(v),$(i).children("a").after(g),$(i).children("a").after("<span title='Remove node' id='remove_"+e.id+"' class='remove' ></span>"),$(i).children("a").after("<span title='Add node' id='add_"+e.id+"' class='add'></span>"),$(i).children("a").after("<span title='Edit: "+e.name+"' id='edit_"+e.id+"' class='edit'></span>"),$(i).children("a").attr("title",e.expression.trim()),$(i).children("a").next().on("click",(function(n){n.preventDefault();var d="li[id='li_"+e.id+"']";descriptionhidden||$(d).children("a").click(),editedNodeId=e.id,$("#inodeOrder").empty();for(var t=0;t<=$(i).siblings().length;t++)$("#inodeOrder").append("<option  value='"+t+"'>"+t+"</option>");FillNodeDialogInfo(editedNodeId),editdialog.dialog("option","title",'Edit: "'+e.name+'"'),editdialog.dialog("open"),$.ajax({url:"getAllNames",type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){for(var i of(allNames.length=0,e))allNames.push(i)}})})),$(i).children(".remove").on("click",(function(i){i.preventDefault(),removeNodeIds=e.id,$("#removeNode").children("label").text('Remove "'+e.name+'"?'),removenodedialog.dialog("open")})),$(i).children(".add").on("click",(function(n){n.preventDefault();var d="li[id='li_"+e.id+"']";descriptionhidden||$(d).children("a").click(),addToNodeId=e.id,"Decision"==$("input[id='nodetype_"+e.id+"']").attr("value")?($("#newinodeOptional").prop("checked",!0),$("#newinodeOptional").attr("disabled","disabled")):($("#newinodeOptional").prop("checked",!1),$("#newinodeOptional").attr("disabled",!1)),$("#newinodeOrder").empty();for(var t=0;t<=$(i).children("ul").children("li").length;t++)$("#newinodeOrder").append("<option  value='"+t+"'>"+t+"</option>");newnodedialog.dialog("option","title",'Insert new node into: "'+e.name+'"'),newnodedialog.dialog("open"),$.ajax({url:"getAllNames",type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){for(var i of(allNames.length=0,e))allNames.push(i)}})})),h=e.optional?13:0,s=e.complete||e.optional&&!e.selected?0:16,editWidth="Decision"!=e.type?$(i).children(".edit").outerWidth(!0):0,p=$(i).children(".add").outerWidth(!0),u=$(i).children(".remove").outerWidth(!0);var m=$(i).children("a").children(".formula"),_=$(i).children("a").children(".name");if($(i).width($("#container").width()-($(i).offset().left-$("#container").offset().left)),l=$(i).width(),o=$(i).children("a").width(),idWidth=0,marginLeft=0,a=$(i).children(".subtotal").width(),r=$(i).children("ins").width(),"none"==m.css("display")?(m.show(),c=m.width(),m.hide()):c=m.width(),f=_.width(),0==m.children("i").length&&(c=0),o+a+r+h+s+editWidth+p+u+25>l){var w=o+a+r+h+s+editWidth+p+u+25-l;c>=w+25?m.width(c-w-25):(m.width(0),_.width(f-(w-c)))}else m.width(c+5),_.width(f+5);var y=getScrollbarWidth(document.getElementById("container"));if($(i).children(".filler").css("width",l-o-a-r-h-s-editWidth-p-u-30-y),l-o-a-r-idWidth-marginLeft-h-s-editWidth-p-u-30-y>0&&$(i).children(".filler").css("margin-right",a+y),"FONT"!=$("li[id='li_"+e.id+"']").children()[0].tagName){var b=$("li[id='li_1']").position().left;$("<font width='100%' size='1' class='id'>&nbsp"+e.id+"</font>").insertBefore("li[id='li_"+e.id+"']>ins"),$(".id").css({position:"absolute",left:b});var x=$("font[id='id_"+e.Id+"']").width(),I=$(i).children("ins").position().left;x>I?$(i).css("margin-left",x-I+13.5):$(i).css("margin-left",13.5)}$("input[id='Subtotals']").is(":checked")||$(".subtotal, .filler").hide()}}function UpdateNodeFromServer(e){$.ajax({url:"NodeInfo?id="+e,type:"GET",dataType:"json",async:!1,cache:!1,beforeSend:function(){},complete:function(){},success:function(e){e.complete||e.optional&&!e.selected?$("li[id='li_"+e.id+"']").children("img").first().hide():$("li[id='li_"+e.id+"']").children("img").first().show(),UpdateNode(e)}})}function NodeInfo(e){$.ajax({url:"NodeInfo?id="+e,type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){return e.complete||e.optional&&!e.selected?$("li[id='li_"+e.id+"']").children("img").first().hide():$("li[id='li_"+e.id+"']").children("img").first().show(),e}})}function UpdateNodesFromServer(e){var i;i=e.split(";"),$.ajax({url:"NodesInfo",type:"POST",dataType:"json",data:{array:i},traditional:!0,async:"true"==asynchronous,cache:!1,beforeSend:function(){},complete:function(){},success:function(e){for(var i=0;i<e.length;i++)e[i].complete||e[i].optional&&!e[i].selected?"li[id='li_"+e[i].id+"'],":"li[id='li_"+e[i].id+"'],",UpdateNode(e[i])}})}function UpdateDependents(e){if("object"==typeof e){for(var i,n="",d=0;d<e.length;d++)n+=";"+e[d]+";"+$("input[id='dependents_"+e[d]+"']").attr("value");i=(i=n.split(";")).filter((function(e,n){return i.indexOf(e)===n})),n="";for(d=0;d<i.length;d++)n+=i[d]+";";UpdateNodesFromServer(n)}else{UpdateNodesFromServer(e+";"+(n=$("input[id='dependents_"+e+"']").attr("value")))}}function UpdateTree(e){$.ajax({url:"NodeInfo?id="+e,type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){UpdateNode(e);var i="li[id='li_"+e.id+"']",n=$(i).children("ul").children("li");if(n&&n.length>0)for(var d=0;d<n.length;d++)UpdateTree(n[d].id.replace(/li_/g,""))}})}function UpdateTreeSync(){var e="";!function i(n){e+=n+";";var d=$("li[id='li_"+n+"']").children("ul").children("li");if(d&&d.length>0)for(var t=0;t<d.length;t++)i(d[t].id.replace(/li_/g,""))}(1),UpdateNodesFromServer(e)}function HideNodes(e){"true"==$("input[id='ishidden_"+e+"']").attr("value")&&$("li[id='li_"+e+"']").hide();var i=$("li[id='li_"+e+"']").children("ul").children("li");if(i&&i.length>0)for(var n=0;n<i.length;n++)HideNodes(i[n].id.replace(/li_/g,""))}function ShowNodes(e){"true"==$("input[id='ishidden_"+e+"']").attr("value")&&($("li[id='li_"+e+"']").css("display","block"),RefreshFillers(e,!1));var i=$("li[id='li_"+e+"']").children("ul").children("li");if(i&&i.length>0)for(var n=0;n<i.length;n++)ShowNodes(i[n].id.replace(/li_/g,""))}function UnHideBranch(e){$("li[id='li_"+e+"']").show();var i=$("li[id='li_"+e+"']").parent().attr("id");"container"!=$("li[id='li_"+e+"']").parent().parent().attr("id")&&UnHideBranch(i.replace(/li_ul_/g,""))}function ToggleSubtotals(){$("input[id='Subtotals']").is(":checked")?($(".subtotal").show(),$(".filler").show(),RefreshFillers(1,!0)):($(".subtotal").hide(),$(".filler").hide())}function ToggleFormulas(){expandingLevels=!1,$("input[id='Formulas']").is(":checked")?($(".formula").show(),RefreshFillers("1",!0)):($(".formula").hide(),RefreshFillers("1",!0))}function ToggleFormulasAsync(){expandingLevels=!1,$("input[id='Formulas']").is(":checked")?($(".filler").width(0),$(".formula").width(0),$(".formula").show(),UpdateTree("1")):($(".formula").hide(),UpdateTree("1"))}function ToggleHiddenFields(){expandingLevels=!1,$("input[id='HiddenFields']").is(":checked")?ShowNodes("1"):HideNodes("1")}function ToggleDescription(){if(expandingLevels=!1,descriptionhidden=!descriptionhidden,$("#description").toggle(),"right"==$("#container").css("float")?($("#container").css("float","left"),$("#container").css("width","100%")):($("#container").css("float","right"),$("#container").css("width","60%")),"left"==$("#container").css("float")?$("#hr").css("width","100%"):$("#hr").css("width","59.5%"),RefreshFillers(1,!0),!descriptionhidden){var e=document.getElementById("Iframe15"),i=e.contentDocument||e.contentWindow.document;i.location=i.location}}function ToggleDescriptionAsync(){if(expandingLevels=!1,descriptionhidden=!descriptionhidden,$("#description").toggle(),"right"==$("#container").css("float")?($("#container").css("float","left"),$("#container").css("width","100%")):($("#container").css("float","right"),$("#container").css("width","60%")),"left"==$("#container").css("float")?$("#hr").css("width","100%"):$("#hr").css("width","59.5%"),$(".filler").width(0),$(".formula").width(0),UpdateTree("1"),!descriptionhidden){var e=document.getElementById("Iframe15"),i=e.contentDocument||e.contentWindow.document;i.location=i.location}}function ToggleCompact(){if(expandingLevels=!1,$("input[id='Compact']").is(":checked")){(e=$("#container li").filter((function(){var e=$(this).parent().attr("id");return null!=e&&"Decision"==$("input[id='nodetype_"+e.replace(/li_ul_/g,"")+"']").attr("value")&&!$(this).children(":checkbox").is(":checked")&&1==$(this).siblings().children("input:checked").length}))).hide()}else{var e;(e=$("#container li").filter((function(){return"none"==$(this).css("display")&&"false"==$("input[id='ishidden_"+$(this).attr("id").replace(/li_/g,"")+"']").attr("value")}))).show();for(var i=0;i<e.length;i++)RefreshFillers(e[i].id.replace(/li_/g,""),!1)}}function ToggleId(){$("input[id='Id']").is(":checked")?ShowIds():HideIds()}function ShowIds(){$(".id").show()}function HideIds(){$(".id").hide()}function EnlargeFillers(e){var i="li[id='li_"+e+"']";$(i).children(".filler").css("width",$(i).children(".filler").width()+$(i).children("a").children(".formula").width());var n=$(i).children("ul").children("li");if(n&&n.length>0)for(var d=0;d<n.length;d++)EnlargeFillers(n[d].id.replace(/li_/g,""))}function ShortenFillers(e){var i="li[id='li_"+e+"']";$(i).children(".filler").css("width",$(i).children(".filler").width()-$(i).children("a").children(".formula").width());var n=$(i).children("ul").children("li");if(n&&n.length>0)for(var d=0;d<n.length;d++)ShortenFillers(n[d].id.replace(/li_/g,""))}function Refill(){RefreshFillers(1,!0)}function RefreshFillers(e,i){var n="li[id='li_"+e+"']";if($(n).length){$(n).width($("#container").width()-($(n).offset().left-$("#container").offset().left));var d=$(n).children("a").children(".name").text(),t=$(n).children("a").children(".formula").children("i").text(),l=$(n).children(".subtotal").children("font").eq(0).text(),o=$(n).children(".subtotal").children("font").eq(1).text();$(n).children("a").empty(),$(n).children("a").append("<span class='name' id='name_"+e+"'>"+d+"</span>"),$(n).children("a").append("<span class='formula' id='formula_"+e+"' >"+("Decision"!=$("input[id='nodetype_"+e+"']").attr("value")&&"SumSet"!=$("input[id='nodetype_"+e+"']").attr("value")?" &nbsp;[<i>"+t.trim()+"</i>]":"")+"</span>"),$("input[id='Formulas']").is(":checked")||$(n).children("a").children(".formula").hide(),$(n).children(".subtotal").remove(),$(n).children(".filler").remove();var a,r,c,s,h,p,u,f,v,g,m,_=$("<div class='filler'>&nbsp;</div>"),w=$("<span class='subtotal' id='subtotal_"+e+"'><font size='1'>"+l+"</font> <font>"+o+"</font></span>");$(n).children("a").after(_),$(n).children("a").after(w),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&"rgb(255, 0, 0)"!=$(n).children("a").css("color")&&"rgb(0, 128, 0)"!=$(n).children("a").css("color")&&$(n).children("a").attr("style","color:gray;"),window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches&&"rgb(255, 0, 0)"!=$(n).children("a").css("color")&&"rgb(0, 128, 0)"!=$(n).children("a").css("color")&&$(n).children("a").attr("style","color:black;"),u=$("input[id='ckbx_"+e+"']").length?13:0,p=$(n).children("img").first().is(":visible")?16:0,f=$(n).children(".edit").length?$(n).children(".edit").outerWidth(!0):0,v=$(n).children(".add").length?$(n).children(".add").outerWidth(!0):0,g=$(n).children(".remove").length?$(n).children(".remove").outerWidth(!0):0;var y=$(n).children("a").children(".formula"),b=$(n).children("a").children(".name");if($(n).width($("#container").width()-($(n).offset().left-$("#container").offset().left)),a=$(n).width(),r=$(n).children("a").width(),c=$(n).children(".subtotal").width(),s=$(n).children("ins").width(),"none"==y.css("display")?(y.show(),h=y.width(),y.hide()):h=y.width(),m=b.width(),r+c+s+u+p+f+v+g+25>a){var x=r+c+s+u+p+f+v+g+25-a;h>=x+25?y.width(h-x-25):(y.width(0),b.width(m-(x-h)))}else y.width(h+5),b.width(m+5);var I=getScrollbarWidth(document.getElementById("container"));if($(n).children(".filler").css("width",a-r-c-s-u-p-f-v-g-30-I),$(n).children(".filler").css("margin-right",c+I),!0){var N=$(n).children("ul").children("li");if(N&&N.length>0)for(var k=0;k<N.length;k++)RefreshFillers(N[k].id.replace(/li_/g,""),!0)}}$("input[id='Subtotals']").is(":checked")||$(".subtotal, .filler").hide()}function OpenNode(e){for(var i=e.split(">"),n="li[id='li_1']",d=0;d<i.length;d++)top.asynchronous=!1,$.jstree._reference(n).open_node(n,(function(){if(d==i.length-1)$.jstree._reference("li[id='li_<%=Model.id%>']").deselect_node("li[id='li_<%=Model.id%>']"),$.jstree._reference(n).select_node(n),$("html").scrollTop($(n).offset().top);else for(var e=$(n).children("ul").children("li"),t=0;t<e.length;t++)if($(e[t]).children("a").children("font:first").text()==i[d+1]){n="li[id='"+$(e[t]).attr("id")+"']";break}}));top.asynchronous=!0}function ExpandLevels(e,i){0!=i&&(asynchronous=!1,$.jstree._reference("li[id='li_"+e+"']").open_node("li[id='li_"+e+"']",(function(){var n=$("li[id='li_"+e+"']").children("ul").children("li");if(n&&n.length>0)for(var d=0;d<n.length;d++)ExpandLevels(n[d].id.replace(/li_/g,""),i-1)})),asynchronous=!0)}function ExpandLevels2(e,i){if(expandingLevels=!0,0!=i){var n=$("li[id='li_"+e+"']").children("ul");if(0==n.length||0==n.children("li").length)$.ajax({url:"ChildNodes?id="+e,type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(e){for(var n=jQuery.parseJSON(e.responseText),d=0;d<n.length;d++)ExpandLevels2(n[d].id,i-1)},success:function(i){Assemble(i,"li_"+e),$("#container").jstree("open_node",$("li[id='li_"+e+"']"))}});else{$("#container").jstree("open_node",$("li[id='li_"+e+"']")),RefreshFillers(e,!0);for(var d=$("li[id='li_"+e+"']").children("ul").children("li"),t=0;t<d.length;t++)ExpandLevels2(d[t].id.replace(/li_/g,""),i-1)}}}function SetUnits(){$("#inodeUnitsText").val($("#inodeUnits").val()),$("#newinodeUnitsText").val($("#newinodeUnits").val())}function FillNodeDialogInfo(e){asynchronous=!1,$.ajax({url:"NodeInfo?id="+e,type:"GET",dataType:"json",async:!1,cache:!1,beforeSend:function(){},complete:function(){},success:function(e){$("#inodeName").val(e.name),$("#inodeType").val(e.type),"Decision"==e.type||"SumSet"==e.type?($("#inodeExpression").attr("disabled","disabled"),$("#inodeExpression").val("")):"Date"==e.type||"Today"==e.type?($("#inodeExpression").attr("disabled","disabled"),$("#inodeExpression").val(e.expression)):($("#inodeExpression").removeAttr("disabled"),$("#inodeExpression").val(e.expression)),$("#inodeExpandedLevels").val(e.expandedLevels),$("#inodeOrder").val(e.order),$("#inodeMin").val(e.min),$("#inodeMax").val(e.max),$("#inodeDiscount").val(e.discount),$("#inodeHidden").prop("checked",e.hidden),$("#inodeOptional").prop("checked",e.optional),$("#inodeDisable").val(e.disableCondition),$("#inodeDisabledMessage").val(e.disabledMessage),e.parentIsDecision?$("#inodeOptional").prop("disabled",!0):$("#inodeOptional").prop("disabled",!1),$("#inodeEditChildren").prop("checked",e.editChildren),$("#inodeReport").prop("checked",e.report),$("#inodeReportValue").prop("checked",e.reportValue),$("#inodeUnits").val(e.units),$("#inodeDecimalPlaces").val(e.decimalPlaces),$("#inodeUnitsText").val(e.units),$("#inodeTemplate").prop("checked",e.template),$("#inodeReadOnly").prop("checked",e.readOnly)}}),asynchronous=!0}function SaveNodeInfo(){var e=$("#inodeName").val(),n=$("#inodeType").val(),d=$("#inodeExpression").val(),t=$("#inodeExpandedLevels").val(),l=$("#inodeOrder").val(),o=$("#inodeMin").val(),a=$("#inodeMax").val(),r=$("#inodeDiscount").val(),c=$("#inodeHidden").is(":checked"),s=$("#inodeOptional").is(":checked"),h=$("#inodeDisable").val(),p=$("#inodeDisabledMessage").val(),u=$("#inodeEditChildren").is(":checked"),f=$("#inodeReport").is(":checked"),v=$("#inodeReportValue").is(":checked"),g=$("#inodeUnitsText").val(),m=$("#inodeDecimalPlaces").val(),_=$("#inodeTemplate").is(":checked"),w=$("#inodeReadOnly").is(":checked"),y="*/+-|[]?&!()><=#{};:,_";if(0==function(e){for(i=0;i<y.length;i++)if(e.indexOf(y[i])>-1)return!0;return!1}(e)){var b="id="+editedNodeId+"&name="+e+"&type="+n+"&expression="+encodeURIComponent(d)+"&expandedLevels="+t+"&order="+l+"&min="+o+"&max="+a+"&discount="+r+"&hidden="+c+"&optional="+s+"&disable="+encodeURIComponent(h)+"&disabledMessage="+encodeURIComponent(p)+"&editChildren="+u+"&report="+f+"&reportValue="+v+"&units="+encodeURI(g)+"&decimalPlaces="+m+"&template="+_+"&readOnly="+w,x=$("#inodeName").serialize();overlay=$("<div></div>").prependTo("body").attr("id","overlay"),$("#overlay").show(),$(".loading").show(),$.ajax({url:"SaveNodeInfo?"+b,type:"GET",data:x,dataType:"json",async:!1,timeout:12e4,cache:!1,beforeSend:function(){},error:function(){alert("Couldn't save node. Either the name is empty or a node with the same name already exists."),$(".loading_dependencies").hide(),$("#overlay").remove(),editdialog.dialog("close")},complete:function(){},success:function(e){if(1!=editedNodeId){var i=$("li[id='li_"+editedNodeId+"']").parent().attr("id").replace(/li_ul_/g,"");$.jstree._reference("li[id='li_"+i+"']").move_node("li[id='li_"+editedNodeId+"']","li[id='li_"+i+"']",parseInt(e.order))}price=document.getElementById("price"),$(price).text("Total: "+e.total),e.hasErrors?(alert(e.error),UpdateTreeSync(),$(".loading_dependencies").hide(),$("#overlay").remove()):(UpdateTreeSync(),$(".loading_dependencies").hide(),$("#overlay").remove(),editdialog.dialog("close"))}}),top.asynchronous=!0}else alert("The name contains illegal characters.")}function NewNode(){var e=$("#newinodeName").val(),n=$("#newinodeType").val(),d=$("#newinodeExpression").val(),t=$("#newinodeExpandedLevels").val(),l=$("#newinodeOrder").val(),o=$("#newinodeMin").val(),a=$("#newinodeMax").val(),r=$("#newinodeDiscount").val(),c=$("#newinodeHidden").is(":checked"),s=$("#newinodeOptional").is(":checked"),h=$("#newinodeDisable").val(),p=$("#newinodeDisabledMessage").val(),u=$("#newinodeEditChildren").is(":checked"),f=$("#newinodeReport").is(":checked"),v=$("#newinodeReportValue").is(":checked"),g=$("#newinodeUnitsText").val(),m=$("#newinodeDecimalPlaces").val(),_=$("#newinodeTemplate").is(":checked"),w=$("#newinodeReadOnly").is(":checked"),y="*/+-|[]?&!()><=#{};:,_";if(0==function(e){for(i=0;i<y.length;i++)if(e.indexOf(y[i])>-1)return!0;return!1}(e)){var b="id="+addToNodeId+"&name="+e+"&type="+n+"&expression="+encodeURIComponent(d)+"&expandedLevels="+t+"&order="+l+"&min="+o+"&max="+a+"&discount="+r+"&hidden="+c+"&optional="+s+"&disable="+encodeURIComponent(h)+"&disabledMessage="+encodeURIComponent(p)+"&editChildren="+u+"&report="+f+"&reportValue="+v+"&units="+encodeURI(g)+"&decimalPlaces="+m+"&template="+_+"&readOnly="+w,x=$("#inodeName").serialize();overlay=$("<div></div>").prependTo("body").attr("id","overlay"),$("#overlay").show(),$(".loading").show(),$.ajax({url:"NewNode?"+b,type:"GET",data:x,dataType:"json",async:!0,cache:!1,timeout:72e5,beforeSend:function(){},complete:function(){UpdateTreeSync(),$(".loading_dependencies").hide(),$("#overlay").remove(),creatingNewNode=!1},error:function(){alert("Couldn't insert the new node."),$(".loading_dependencies").hide(),$("#overlay").remove(),creatingNewNode=!1},success:function(e){e.hasErrors?alert(e.error):null!=e&&(creatingNewNode=!0,""!=addToNodeId?($("#container").jstree("create",null,parseInt(e.order),{data:" ",attr:{class:"jstree-closed",id:"li_"+e.id}},!1,!0),$("li[id='li_"+e.id+"']").children("a").remove(),null==$("li[id='li_"+e.id+"']").parent().attr("id")&&$("li[id='li_"+e.id+"']").parent().attr("id","li_ul_"+addToNodeId),UpdateNode(e)):($("#container").jstree("create",null,parseInt(e.order),{data:" ",attr:{class:"jstree-closed",id:"li_"+e.id}},!1,!0),UpdateNodeFromServer("1")),$("#newinodeName").val(""),$("#newinodeType").val("Math"),$("#newinodeExpression").val(""),$("#newinodeExpandedLevels").val(""),$("#newinodeOrder").val(""),$("#newinodeMin").val(""),$("#newinodeMax").val(""),$("#newinodeDiscount").val(""),$("#newinodeHidden").attr("checked",!1),$("#newinodeOptional").attr("checked",!1),$("#newinodeEditChildren").attr("checked",!1),$("#newinodeReport").attr("checked",!1),$("#newinodeReportValue").attr("checked",!1),$("#newinodeUnits").val(""),$("#newinodeDecimalPlaces").val(""),newnodedialog.dialog("close"))}})}else alert("The name contains illegal characters.")}function removeNodes(){$.ajax({url:"removeNodes?ids="+removeNodeIds,type:"GET",async:!1,dataType:"text",cache:!1,beforeSend:function(){},complete:function(){removenodedialog.dialog("close")},success:function(e){if(""!=e){price=document.getElementById("price"),$(price).text("Total: "+e);for(var i=removeNodeIds.split(";"),n=0;n<i.length;n++)if(""!=i[n]){var d=$("li[id='li_"+i[n]+"']").parent().attr("id");"Decision"==$("input[id='nodetype_"+d.replace(/li_ul_/g,"")+"']").attr("value")&&$("li[id='li_"+i[n]+"']").siblings().show(),$("li[id='li_"+i[n]+"']").remove()}UpdateTree(1)}else alert("Some nodes could not be removed.")}})}function Assemble(e,i){var n=i;$(i).children("ul");$("#container").jstree("select_node",$("li[id='"+n+"']"));for(var d=0;d<e.length;d++){$("#container").jstree("create",null,"last",{data:" ",attr:{class:"jstree-closed",id:"li_"+e[d].id}},!1,!0),UpdateNode(e[d]),1!=e[d].hidden||$("input[id='HiddenFields']").is(":checked")||$("li[id='li_"+e[d].id+"']").hide();var t=e[d].url;$("li[id='li_"+e[d].id+"']").children("a").attr("href",t),$("li[id='li_"+e[d].id+"']").children("a").attr("target","details"),$("li[id='li_"+e[d].id+"']").children("a").attr("title",e[d].expression)}$("li[id='"+n+"']").children("ul").attr("id","li_ul_"+n.replace(/li_/g,"")),$("#container").jstree("deselect_node",$("li[id='"+n+"']"))}function RenderTree(e){var i=e.Id.substr(0,e.Id.lastIndexOf("."));1!=e.Id&&$("#container").jstree("select_node",$("li[id='li_"+i+"']")),$("#container").jstree("create",null,"last",{data:" ",attr:{class:"jstree-closed",id:"li_"+e.Id}},!1,!0);var n="li[id='li_"+e.Id+"']";if($(n).length){var d,t;$(n).css("white-space","normal"),$(n).width($("#container").width()-($(n).offset().left-$("#container").offset().left)),$("input[id='ckbx_"+e.Id+"']").remove(),e.Optional&&(d=1==e.Selected?"checked":"",t="<input type='checkbox' ",e.Disabled&&($(n).siblings().show(),t+="disabled='true'"),t+=" id='ckbx_"+e.Id+"' style='padding:0px 0px 0px 0px; margin:0px 0px 0px 2px;' onchange='CheckBoxClickHandler(this, true);' "+d+"/>",$(n).children("ins").after(t)),t="<img src='../Images/blinkcircle.gif' class='incomplete' style='display: none;' height='14' width='14'>",$(n).children(".incomplete").remove(),$(n).children("ins").after(t),e.Complete||e.Optional&&!e.Selected?$(n).children(".incomplete").hide():$(n).children(".incomplete").show();var l="../"+e.Url;$(n).children("a").attr("href",l),$(n).children("a").attr("target","details"),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&"rgb(255, 0, 0)"!=$(n).children("a").css("color")&&"rgb(0, 128, 0)"!=$(n).children("a").css("color")&&$(n).children("a").attr("style","color:gray;"),window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches&&"rgb(255, 0, 0)"!=$(n).children("a").css("color")&&"rgb(0, 128, 0)"!=$(n).children("a").css("color")&&$(n).children("a").attr("style","color:black;"),e.Leaf&&$("li[id='li_"+e.Id+"']").children("a").attr("style","color:red;"),e.Hidden&&$("li[id='li_"+e.Id+"']").children("a").attr("style","color:green");var o="";o="Decision"!=e.TypeStr&&"SumSet"!=e.TypeStr&&"Text"!=e.TypeStr||"Text"==e.TypeStr?"&nbsp;[<i>"+e.Expression+"</i>]":" &nbsp;&nbsp;&nbsp;",$(n).children("a").attr("title",e.Expression),t="<input type='hidden' id='nodetype_"+e.Id+"' value='"+e.TypeStr+"'/> ",$("li[id='li_"+e.Id+"']").append(t),t="<input type='hidden' id='ishidden_"+e.Id+"' value='"+e.Hidden+"'/> ",$("li[id='li_"+e.Id+"']").append(t),t="<input type='hidden' id='isoptional_"+e.Id+"' value='"+e.Optional+"'/> ",$("li[id='li_"+e.Id+"']").append(t),t="<input type='hidden' id='dependents_"+e.Id+"' value='"+e.DependentsStr+"'/> ",$("li[id='li_"+e.Id+"']").append(t),t="<input type='hidden' id='editchildren_"+e.Id+"' value='"+e.EditChildren+"'/> ",$("li[id='li_"+e.Id+"']").append(t),t="<input type='hidden' id='expandedlevels_"+e.Id+"' value='"+e.ExpandedLevels+"'/> ",$("li[id='li_"+e.Id+"']").append(t),$(n).children("a").append("<span class='name' id='name_"+e.Id+"'>"+e.Name+"</span>"),$(n).children("a").append("<span class='formula' id='formula_"+e.Id+"' > "+o.trim()+"</span>"),$("input[id='Formulas']").is(":checked")||$(n).children("a").children(".formula").hide(),$(n).children(".subtotal").remove(),$(n).children(".filler").remove(),$(n).children(".edit").remove(),$(n).children(".add").remove(),$(n).children(".remove").remove();var a,r,c,s,h,p,u,f,v,g,m=$("<div class='filler'>&nbsp;</div>"),_=$("<span class='subtotal' id='subtotal_"+e.Id+"'><font size='1'>"+e.TypeStr+"</font>  <font>["+e.TotalStr+"]</font></span>");$(n).children("a").after(m),$(n).children("a").after(_),$(n).children("a").after("<span title='Remove node' id='remove_"+e.Id+"' class='remove' ></span>"),$(n).children("a").after("<span title='Add node' id='add_"+e.Id+"' class='add'></span>"),$(n).children("a").after("<span title='Edit: "+e.Name+"' id='edit_"+e.Id+"' class='edit'></span>"),$(n).children("a").next().on("click",(function(i){i.preventDefault();var d="li[id='li_"+e.Id+"']";descriptionhidden||$(d).children("a").click(),editedNodeId=e.Id,$("#inodeOrder").empty();for(var t=0;t<=$(n).siblings().length;t++)$("#inodeOrder").append("<option  value='"+t+"'>"+t+"</option>");FillNodeDialogInfo(editedNodeId),editdialog.dialog("option","title",'Edit: "'+e.Name+'"'),editdialog.dialog("open"),$.ajax({url:"getAllNames",type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){for(var i of(allNames.length=0,e))allNames.push(i)}})})),$(n).children(".remove").on("click",(function(i){i.preventDefault(),removeNodeIds=e.Id,$("#removeNode").children("label").text('Remove "'+e.Name+'"?'),removenodedialog.dialog("open")})),$(n).children(".add").on("click",(function(i){i.preventDefault();var d="li[id='li_"+e.Id+"']";descriptionhidden||$(d).children("a").click(),addToNodeId=e.Id,"Decision"==$("input[id='nodetype_"+e.Id+"']").attr("value")?($("#newinodeOptional").prop("checked",!0),$("#newinodeOptional").attr("disabled","disabled")):($("#newinodeOptional").prop("checked",!1),$("#newinodeOptional").attr("disabled",!1)),$("#newinodeOrder").empty();for(var t=0;t<=$(n).children("ul").children("li").length;t++)$("#newinodeOrder").append("<option  value='"+t+"'>"+t+"</option>");newnodedialog.dialog("option","title",'Insert new node into: "'+e.Name+'"'),newnodedialog.dialog("open"),$.ajax({url:"getAllNames",type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){for(var i of(allNames.length=0,e))allNames.push(i)}})})),u=$("input[id='ckbx_"+e.Id+"']").length?13:0,p=$(n).children("img").first().is(":visible")?16:0,editWidth="Decision"!=e.TypeStr?$(n).children(".edit").outerWidth(!0):0,f=$(n).children(".add").outerWidth(!0),v=$(n).children(".remove").outerWidth(!0);var w=$(n).children("a").children(".formula"),y=$(n).children("a").children(".name");if($(n).width($("#container").width()-($(n).offset().left-$("#container").offset().left)),a=$(n).width(),r=$(n).children("a").width(),c=$(n).children(".subtotal").width(),s=$(n).children("ins").width(),"none"==w.css("display")?(w.show(),h=w.width(),w.hide()):h=w.width(),g=y.width(),0==w.children("i").length&&(h=0),r+c+s+u+p+editWidth+f+v+25>a){var b=r+c+s+u+p+editWidth+f+v+25-a;h>=b+25?w.width(h-b-25):(w.width(0),y.width(g-(b-h)))}else w.width(h+5),y.width(g+5);var x=getScrollbarWidth(document.getElementById("container"));$(n).children(".filler").css("width",a-r-c-s-u-p-editWidth-f-v-30-x),$(n).children(".filler").css("margin-right",c+x);var I=$("li[id='li_1']").position().left;$("<font width='100%' size='1' class='id' id = 'id_"+e.Id+"'>&nbsp"+e.Id+"</font>").insertBefore("li[id='li_"+e.Id+"']>ins"),$(".id").css({position:"absolute",left:I});var N=$("font[id='id_"+e.Id+"']").width(),k=$(n).children("ins").position().left;N>k?$(n).css("margin-left",N-k+13.5):$(n).css("margin-left",13.5),$("input[id='Subtotals']").is(":checked")||$(".subtotal, .filler").hide(),0==$(n).children("ul").length&&$(n).append("<ul id='li_ul_"+e.Id+"' style='display:inline'></ul>")}if(null!=e._Children)for(var T=0;T<e._Children.length;T++)null!=e._Children[T].Id&&RenderTree(e._Children[T]);$("#container").jstree("deselect_node",$("li[id='li_"+i+"']"))}function SaveDefinition(){overlay=$("<div></div>").prependTo("body").attr("id","overlay"),$("#overlay").show(),$(".loading").show(),$.ajax({url:"SaveDefinition",type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){$(".loading_dependencies").hide(),$("#overlay").remove()},success:function(){}})}function PruneTree(e,i){var n=e.Id.split(".").length-1;if("1"==e.Id||n!=i.ExpandedLevels)for(var d=0;d<e._Children.length;d++)PruneTree(e._Children[d],i);else e._Children=null}function lzw_decode(e){for(var i,n={},d=(e+"").split(""),t=d[0],l=t,o=[t],a=256,r=1;r<d.length;r++){var c=d[r].charCodeAt(0);i=c<256?d[r]:n[c]?n[c]:l+t,o.push(i),t=i.charAt(0),n[a]=l+t,a++,l=i}return o.join("")}function replaceLastOccurrence(e,i,n){const d=e.lastIndexOf(i);if(-1===d)return e;return e.slice(0,d)+n+e.slice(d+i.length)}$((function(){function e(e){return e.split(/[()*/%+-?&!><=:,]+/g)}descriptionhidden=!1,ajaxDone=!1,asynchronous=!0,mobile=!1,copyNodesId="",treeIsLoaded=!1,expandingLevels=!1,creatingNewNode=!1,allNames=[],dialogHeight=98*window.innerHeight/100,$("#container").jstree({plugins:["themes","html_data","ui","crrm","contextmenu"],contextmenu:{items:function(e){return{Edit:{label:"Edit",action:function(e){nodeId=e.attr("id").replace(/li_/g,""),$("span[id='edit_"+nodeId+"']").click()}},Add:{label:"Add",action:function(e){nodeId=e.attr("id").replace(/li_/g,""),$("span[id='add_"+nodeId+"']").click()}},Remove:{label:"Remove",action:function(e){removeNodeIds="";var i=$("#container").jstree("get_selected");if(i.length>1){for(var n=0;n<i.length;n++)removeNodeIds+=i[n].id.replace(/li_/g,"")+";";$("#removeNode").children("label").text("Remove multiple nodes?"),removenodedialog.dialog("open")}else nodeId=e.attr("id").replace(/li_/g,""),$("span[id='remove_"+nodeId+"']").click()}},Copy:{label:"Copy",action:function(e){copyNodesId="";var i=$("#container").jstree("get_selected");if(this.copy(i),i.length<=1)copyNodesId=e.attr("id").replace(/li_/g,"");else for(var n=0;n<i.length;n++)copyNodesId+=i[n].id.replace(/li_/g,"")+";"}},Paste:{label:"Paste",action:function(e){var i=e.attr("id").replace(/li_/g,"");null!=copyNodesId&&""!=copyNodesId&&(overlay=$("<div></div>").prependTo("body").attr("id","overlay"),$("#overlay").show(),$(".loading").show(),$.ajax({url:"cloneNodes?sourceId="+copyNodesId+"&targetId="+i,type:"GET",async:!0,dataType:"json",cache:!1,beforeSend:function(){},complete:function(){$(".loading_dependencies").hide(),$("#overlay").remove(),creatingNewNode=!1},error:function(){alert("An error occurred while copying the node."),$(".loading_dependencies").hide(),$("#overlay").remove(),creatingNewNode=!1},success:function(n){for(var d=0;d<n.length;d++)creatingNewNode=!0,$("#container").jstree("create",e,parseInt(n[d].order),{data:" ",attr:{class:"jstree-closed",id:"li_"+n[d].id}},!1,!0),$("li[id='li_"+n[d].id+"']").children("a").remove(),null==$("li[id='li_"+n[d].id+"']").parent().attr("id")&&$("li[id='li_"+n[d].id+"']").parent().attr("id","li_ul_"+i),UpdateNode(n[d]);UpdateTreeSync(),$("#container").jstree("deselect_all"),price=document.getElementById("price"),$(price).text("Total: "+n[0].total)}}))}}}}},themes:{theme:"default",dots:!1,icons:!1}}).bind("loaded.jstree",(function(e,i){ExpLevels=0,$.ajax({url:"getJson",type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(){},success:function(e){if(null!=e){var i=JSON.parse(e);PruneTree(i,i),RenderTree(i),RefreshFillers(1,!1),treeIsLoaded=!0}else addToNodeId="",$("#newinodeOrder").empty(),$("#newinodeOrder").append("<option  value='0'>0</option>"),newnodedialog.dialog("option","title","Insert first node"),newnodedialog.dialog("open"),newnodedialog.closest("div.ui-dialog").find("button.ui-dialog-titlebar-close").click((function(e){$("#li_1").children("a").length||(document.location="../Home/Index"),e.preventDefault()}));descriptionOffsetTop=$("#description").offset().top,$("#Iframe15").height($(window).height()-descriptionOffsetTop-70),$("#container").height($(window).height()-descriptionOffsetTop-40)}})})),$("#container").bind("open_node.jstree",(function(e,i){var n=i.rslt.obj.attr("id"),d=i.rslt.obj.find("ul");$("input[id='HiddenFields']").is(":checked")||HideNodes(n.replace(/li_/g,""),""),show_all=-1!=document.location.href.search("true")?"true":"false",0==d.length||0==$(d).children("li").length?asynchronous?$.ajax({url:"ChildNodes?id="+n,type:"GET",dataType:"json",cache:!1,beforeSend:function(){},complete:function(e){},success:function(e){Assemble(e,n)}}):$.ajax({url:"ChildNodes?id="+n,type:"GET",dataType:"json",async:!1,cache:!1,beforeSend:function(){},complete:function(e){},success:function(e){Assemble(e,n)}}):!treeIsLoaded||expandingLevels||creatingNewNode||RefreshFillers(n.replace(/li_/g,""),!0)})),$("#container").bind("select_node.jstree",(function(e,i){i.args[0].href&&(document.getElementById("Iframe15").src=i.args[0].href)})),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(mobile=!0),$("textarea").on("keydown",(function(e){e.keyCode===$.ui.keyCode.TAB&&$(this).autocomplete("instance").menu.active&&e.preventDefault()})).autocomplete({minLength:0,source:function(i,n){n($.ui.autocomplete.filter(allNames,e(i.term).pop().trimLeft().trimRight()))},focus:function(){return!1},select:function(i,n){var d=e(this.value);return this.value=replaceLastOccurrence(this.value,d[d.length-1],"")," "!=n.item.value[0]&&(n.item.value=" "+n.item.value)," "!=n.item.value[n.item.value.length-1]&&(n.item.value=n.item.value+" "),this.value=this.value+n.item.value,!1}}),$(window).on("resize",(function(){var e=editdialog.dialog("isOpen"),n=newnodedialog.dialog("isOpen"),d=dialog.dialog("isOpen");if(dialogHeight=98*window.innerHeight/100,editdialog.dialog("close"),newnodedialog.dialog("close"),dialog.dialog("close"),editdialog=$("#inodeInfo").dialog({autoOpen:!1,modal:!0,resizable:!1,width:"auto",height:"auto",maxHeight:dialogHeight,title:"Edit node",close:function(){$(".loading_dependencies").hide(),$("#overlay").remove()},buttons:{Save:function(){return SaveNodeInfo(),!1}}}).css({overflow:"auto"}),newnodedialog=$("#inewnodeInfo").dialog({autoOpen:!1,modal:!0,resizable:!1,width:"auto",height:"auto",maxHeight:dialogHeight,title:"Insert new node",close:function(){},buttons:{Save:function(){NewNode()}}}).css({overflow:"auto"}),dialog=$("<div></div>").append(i).appendTo("body").dialog({autoOpen:!1,modal:!0,resizable:!1,width:"auto",height:"auto",maxHeight:dialogHeight,title:"Description",close:function(){i.attr("src","about:blank")}}).css({overflow:"auto"}),e&&editdialog.dialog("open"),n&&newnodedialog.dialog("open"),$(window).width()<"1024"&&$("input[id='Description']").is(":checked")&&(descriptionOffsetTop=$("#description").offset().top,$("input[id='Description']").click()),$(window).width()>="1024"&&!$("input[id='Description']").is(":checked")?($("input[id='Description']").click(),descriptionOffsetTop=$("#description").offset().top):$("input[id='Description']").is(":checked")&&(descriptionOffsetTop=$("#description").offset().top),$("#description").is(":hidden")&&d){var t=document.getElementById("Iframe15").contentWindow.location.href,l=mobile?"100%":40*$("#hr").width()/100,o=l;i.attr({width:+l,height:+o,src:t}),dialog.dialog("open")}Refill(),containerOffsetTop=$("#container").offset().top,$("#Iframe15").height($(window).height()-descriptionOffsetTop-70),$("#container").height($(window).height()-containerOffsetTop)}));var i=$('<iframe style="border:0;" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>');dialog=$("<div></div>").append(i).appendTo("body").dialog({autoOpen:!1,modal:!0,resizable:!1,width:"auto",height:"auto",maxHeight:dialogHeight,title:"Description",close:function(){i.attr("src","about:blank")}}).css({overflow:"auto"}),$("#Iframe15").on("load",(function(e){if(descriptionhidden){e.preventDefault();var n=document.getElementById("Iframe15").contentWindow.location.href,d=mobile?"100%":40*$("#hr").width()/100,t=d;i.attr({width:+d,height:+t,src:n}),dialog.dialog("open")}})),editdialog=$("#inodeInfo").dialog({autoOpen:!1,modal:!0,resizable:!1,width:"auto",height:"auto",maxHeight:dialogHeight,title:"Edit node",close:function(){$(".loading_dependencies").hide(),$("#overlay").remove()},buttons:{Save:function(){return SaveNodeInfo(),!1}}}).css({overflow:"auto"}),newnodedialog=$("#inewnodeInfo").dialog({autoOpen:!1,modal:!0,resizable:!1,width:"auto",height:"auto",maxHeight:dialogHeight,title:"Insert new node",close:function(){},buttons:{Save:function(){NewNode()}}}).css({overflow:"auto"}),removenodedialog=$("#removeNode").dialog({autoOpen:!1,modal:!0,resizable:!1,width:"auto",height:"auto",close:function(){},buttons:{Remove:function(){removeNodes()}}}),$(window).width()<"1024"&&$("input[id='Description']").click(),document.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1)}));